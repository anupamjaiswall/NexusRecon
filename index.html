<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NexusRecon - Advanced Recon Framework</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Font Awesome for Live2D widget icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
  <style>
    @keyframes grid-pan {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }

    body {
      font-family: 'Fira Code', monospace;
      background-color: #0a0a1a; /* Dark blue-black */
      color: #00ffdd; /* Bright Cyan */
      overflow-x: hidden;
      /* Cyberpunk grid background */
      background-image: 
        linear-gradient(to right, rgba(0, 221, 255, 0.1) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0, 221, 255, 0.1) 1px, transparent 1px);
      background-size: 40px 40px;
      animation: grid-pan 120s linear infinite; /* Made animation slower */
    }

    .hacker-container {
        position: relative;
        border: 1px solid #ff00c1; /* Magenta */
        box-shadow: 0 0 15px rgba(255, 0, 193, 0.3), inset 0 0 10px rgba(255, 0, 193, 0.15);
        background-color: rgba(10, 10, 26, 0.85);
        backdrop-filter: blur(8px);
    }

    /* HUD Corner Brackets */
    .hacker-container::before, .hacker-container::after,
    .hacker-container > :first-child::before, .hacker-container > :first-child::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        border-color: #00ffdd; /* Bright Cyan */
        border-style: solid;
        transition: all 0.3s ease;
    }
    .hacker-container:hover::before, .hacker-container:hover::after,
    .hacker-container:hover > :first-child::before, .hacker-container:hover > :first-child::after {
        border-color: #ff00c1;
    }
    .hacker-container::before { top: -2px; left: -2px; border-width: 2px 0 0 2px; }
    .hacker-container::after { top: -2px; right: -2px; border-width: 2px 2px 0 0; }
    .hacker-container > :first-child::before { bottom: -2px; left: -2px; border-width: 0 0 2px 2px; }
    .hacker-container > :first-child::after { bottom: -2px; right: -2px; border-width: 0 2px 2px 0; }


    .glitch {
      font-size: 2.5rem; /* Slightly smaller on mobile */
      font-weight: 700;
      position: relative;
      color: #00ffdd;
      text-shadow: 0 0 5px #00ffdd, 0 0 10px #00ffdd;
      animation: glitch-animation 5s infinite linear alternate-reverse;
    }
    @media (min-width: 768px) {
      .glitch {
        font-size: 3rem;
      }
    }

    .glitch::before,
    .glitch::after {
      content: attr(data-text);
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0a1a;
      overflow: hidden;
    }

    .glitch::before {
      left: 3px;
      text-shadow: -3px 0 #ff00c1; /* Magenta */
      animation: glitch-before 7s infinite linear alternate-reverse;
    }

    .glitch::after {
      left: -3px;
      text-shadow: -3px 0 #00ff41; /* Green */
      animation: glitch-after 3s infinite linear alternate-reverse;
    }

    @keyframes glitch-animation { 0% { clip-path: inset(23% 0 34% 0); } 100% { clip-path: inset(72% 0 15% 0); } }
    @keyframes glitch-before { 0% { clip-path: inset(0 0 100% 0); } 100% { clip-path: inset(90% 0 3% 0); } }
    @keyframes glitch-after { 0% { clip-path: inset(100% 0 0 0); } 100% { clip-path: inset(3% 0 90% 0); } }

    .hacker-input, .note-input, .workspace-textarea, .hacker-select {
        background-color: rgba(0, 221, 255, 0.05);
        border: 1px solid #00ffdd;
        color: #00ffdd;
        transition: all 0.3s ease;
    }
    .hacker-input:focus, .note-input:focus, .workspace-textarea:focus, .hacker-select:focus {
        outline: none;
        box-shadow: 0 0 10px #00ffdd;
        background-color: rgba(0, 221, 255, 0.1);
    }
    .hacker-select option {
        background-color: #0a0a1a;
        color: #00ffdd;
    }

    .hacker-btn {
      background-color: transparent;
      border: 1px solid #00ffdd;
      color: #00ffdd;
      text-shadow: 0 0 5px #00ffdd;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      will-change: transform; /* Performance hint for browser */
    }
    .hacker-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(120deg, transparent, rgba(0, 221, 255, 0.4), transparent);
        transition: all 0.5s;
    }
    .hacker-btn:hover::before {
        left: 100%;
    }
    .hacker-btn:hover {
        background-color: #00ffdd;
        color: #0a0a1a;
        box-shadow: 0 0 20px #00ffdd;
    }
    
    .category-title {
        color: #ff00c1;
        text-shadow: 0 0 8px #ff00c1;
        /* Replaced pulse with a more subtle glow for performance */
    }
    
    .subcategory-title {
        color: #00ffdd;
        text-shadow: 0 0 5px #00ffdd;
    }

    .dork-item {
        background-color: transparent;
        border: 1px solid rgba(255, 0, 193, 0.5);
        transition: all 0.3s ease;
        position: relative;
    }
    .dork-item:hover {
        border-color: #ff00c1;
        box-shadow: 0 0 10px rgba(255, 0, 193, 0.5);
        transform: translateY(-3px);
    }
    .dork-text {
        color: #00ffdd;
    }
    .dork-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); /* Adjusted for better responsiveness */
        gap: 1rem;
    }
    
    @keyframes shake-error-animation {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }

    .shake-error {
      animation: shake-error-animation 0.82s cubic-bezier(.36,.07,.19,.97) both;
    }
    
    .tab-btn {
        background-color: transparent;
        border: 1px solid #00ffdd;
        color: #00ffdd;
        transition: all 0.3s ease;
    }
    .tab-btn.active {
        background-color: #00ffdd;
        color: #0a0a1a;
        box-shadow: 0 0 15px #00ffdd;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200">

  <div class="container mx-auto px-4 py-8 md:py-12">
    <header class="text-center mb-10">
      <h1 class="glitch" data-text="NexusRecon">NexusRecon</h1>
      <p class="text-cyan-400 mt-4 text-lg">[ Advanced Reconnaissance Framework ]</p>
    </header>

    <main>
      <!-- Target Input Section -->
      <div class="mb-12 hacker-container p-6 rounded-lg">
        <div> <!-- This extra div is for the corner brackets -->
            <label class="block text-lg font-medium text-cyan-400 mb-2">// Select Recon Mode & Enter Target:</label>
            <div id="recon-mode-tabs" class="flex flex-wrap gap-2 mb-4">
                <button class="tab-btn active py-2 px-4 rounded-md" data-mode="website">Website Recon</button>
                <button class="tab-btn py-2 px-4 rounded-md" data-mode="user">User Recon</button>
            </div>
            <div class="flex flex-col sm:flex-row gap-4">
              <input type="text" id="target-input" placeholder="Enter Domain or Company..." class="w-full px-4 py-3 hacker-input rounded-md" />
              <button id="clear-target" class="bg-red-600/50 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-md hacker-btn border-red-500">Clear</button>
            </div>
            <p id="error-message" class="text-red-400 mt-2 hidden"></p>
        </div>
      </div>

      <!-- Recon Modules -->
      <div class="space-y-10">

        <!-- Live CTI & Vulnerability Feed -->
        <div data-recon-type="all">
            <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Live CTI & Vulnerability Feed</h2>
            <div class="hacker-container p-6 rounded-lg space-y-4">
                <div>
                    <p class="text-gray-400 mb-4">// Latest threat intelligence. Feed is static and requires a backend to be live.</p>
                    <div id="cti-feed" class="max-h-96 overflow-y-auto space-y-3 pr-2">
                        <!-- CTI entries will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Investigation Workspace -->
        <div data-recon-type="all">
            <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Investigation Workspace</h2>
            <div class="hacker-container p-6 rounded-lg space-y-4">
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-gray-400">// Notes are saved per-target in your browser...</p>
                        <button id="clear-workspace" class="hacker-btn text-sm p-2 border-red-500 text-red-400">[ Clear Workspace for this Target ]</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="workspace-subdomains" class="block text-cyan-400 mb-2">Subdomains:</label>
                            <textarea id="workspace-subdomains" rows="4" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="example.com&#10;dev.example.com"></textarea>
                        </div>
                        <div>
                            <label for="workspace-emails" class="block text-cyan-400 mb-2">Email Addresses:</label>
                            <textarea id="workspace-emails" rows="4" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="admin@example.com"></textarea>
                        </div>
                        <div>
                            <label for="workspace-ips" class="block text-cyan-400 mb-2">IP Addresses:</label>
                            <textarea id="workspace-ips" rows="4" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="192.168.1.1"></textarea>
                        </div>
                        <div>
                            <label for="workspace-urls" class="block text-cyan-400 mb-2">Interesting URLs:</label>
                            <textarea id="workspace-urls" rows="4" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="example.com/login.php"></textarea>
                        </div>
                        <div class="md:col-span-2">
                             <label for="workspace-notes" class="block text-cyan-400 mb-2">General Notes:</label>
                             <textarea id="workspace-notes" rows="6" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="Found potential vulnerability in..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Session History -->
        <div data-recon-type="all">
            <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Session History</h2>
            <div class="hacker-container p-6 rounded-lg space-y-4">
                <div>
                    <div class="flex justify-between items-center">
                        <p class="text-gray-400">// Your activity is saved locally in your browser...</p>
                        <button id="clear-history" class="hacker-btn text-sm p-2 border-red-500 text-red-400">[ Clear History ]</button>
                    </div>
                    <div id="history-container" class="mt-4 max-h-96 overflow-y-auto space-y-3 pr-2">
                        <!-- History entries will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Automated Recon Workflows -->
        <div data-recon-type="website">
            <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Automated Recon Workflows</h2>
            <div class="space-y-10">
                <!-- Automated Target Profiler -->
                <div class="hacker-container p-6 rounded-lg space-y-4">
                    <div>
                        <h3 class="subcategory-title text-xl font-semibold mb-2">// Automated Target Profiler</h3>
                        <p class="text-gray-400 mb-4">// Run a sequence of essential dorks against the target...</p>
                        <button id="initiate-profile" class="w-full hacker-btn font-bold py-3 px-6 rounded-md">
                            [ Initiate Target Profile ]
                        </button>
                        <div id="profiler-results-container" class="hidden mt-4 pt-4 border-t border-fuchsia-500/50">
                            <p id="profiler-status" class="text-cyan-400 mb-4"></p>
                            <div id="profiler-results-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
                <!-- Target Tech-Stack Identifier -->
                <div class="hacker-container p-6 rounded-lg space-y-4">
                    <div>
                        <h3 class="subcategory-title text-xl font-semibold mb-2">// Target Tech-Stack Identifier</h3>
                        <p class="text-gray-400 mb-4">// Run dorks to identify the target's technology stack...</p>
                        <button id="identify-tech" class="w-full hacker-btn font-bold py-3 px-6 rounded-md">
                            [ Identify Tech Stack ]
                        </button>
                        <div id="tech-results-container" class="hidden mt-4 pt-4 border-t border-fuchsia-500/50">
                            <p id="tech-status" class="text-cyan-400 mb-4"></p>
                            <div id="tech-results-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manual Investigation Modules -->
        <div>
            <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Manual Investigation Modules</h2>
            <div class="space-y-10">
                <!-- External Reconnaissance -->
                <div class="hacker-container p-6 rounded-lg space-y-6">
                    <div>
                        <h3 class="subcategory-title text-xl font-semibold mb-4">// OSINT & External Tools</h3>
                        <div class="dork-grid">
                            <button id="external-virustotal" class="hacker-btn p-3" data-recon-type="website">[ VirusTotal ]</button>
                            <button id="external-censys" class="hacker-btn p-3" data-recon-type="website">[ Censys ]</button>
                            <button id="external-shodan" class="hacker-btn p-3" data-recon-type="website">[ Shodan ]</button>
                            <button id="external-netlas" class="hacker-btn p-3" data-recon-type="website">[ Netlas.io ]</button>
                            <button id="external-fofa" class="hacker-btn p-3" data-recon-type="website">[ FOFA.so ]</button>
                            <button id="external-zoomeye" class="hacker-btn p-3" data-recon-type="website">[ ZoomEye ]</button>
                            <button id="external-securityheaders" class="hacker-btn p-3" data-recon-type="website">[ SecurityHeaders.io ]</button>
                            <button id="external-securitytrails" class="hacker-btn p-3" data-recon-type="website">[ SecurityTrails ]</button>
                            <button id="external-crtsh" class="hacker-btn p-3" data-recon-type="website">[ crt.sh ]</button>
                            <button id="external-dnsdumpster" class="hacker-btn p-3" data-recon-type="website">[ DNSdumpster ]</button>
                            <button id="external-passivetotal" class="hacker-btn p-3" data-recon-type="website">[ PassiveTotal ]</button>
                            <button id="external-viewdns" class="hacker-btn p-3" data-recon-type="website">[ ViewDNS.info ]</button>
                            <button id="external-whois" class="hacker-btn p-3" data-recon-type="website">[ who.is ]</button>
                            <button id="external-rapiddns" class="hacker-btn p-3" data-recon-type="website">[ RapidDNS ]</button>
                            <button id="external-ptrarchive" class="hacker-btn p-3" data-recon-type="website">[ PTR Archive ]</button>
                            <button id="external-dnslytics" class="hacker-btn p-3" data-recon-type="website">[ DNSlytics ]</button>
                            <button id="external-domainbigdata" class="hacker-btn p-3" data-recon-type="website">[ DomainBigData ]</button>
                            <button id="external-dnsdb" class="hacker-btn p-3" data-recon-type="website">[ DNSDB ]</button>
                            <button id="external-github" class="hacker-btn p-3" data-recon-type="all">[ GitHub ]</button>
                            <button id="external-pastebin" class="hacker-btn p-3" data-recon-type="all">[ Pastebin ]</button>
                            <button id="external-leakix" class="hacker-btn p-3" data-recon-type="website">[ LeakIX ]</button>
                            <button id="external-grepapp" class="hacker-btn p-3" data-recon-type="all">[ Grep.app ]</button>
                            <button id="external-searchcode" class="hacker-btn p-3" data-recon-type="all">[ Searchcode ]</button>
                            <button id="external-grayhat" class="hacker-btn p-3" data-recon-type="website">[ Grayhat Warfare ]</button>
                            <button id="external-dehashed" class="hacker-btn p-3" data-recon-type="all">[ Dehashed ]</button>
                            <button id="external-scylla" class="hacker-btn p-3" data-recon-type="all">[ Scylla.sh ]</button>
                            <button id="external-haveibeenpwned" class="hacker-btn p-3" data-recon-type="all">[ HaveIBeenPwned ]</button>
                            <button id="external-wayback" class="hacker-btn p-3" data-recon-type="website">[ Waybackurls ]</button>
                            <button id="external-urlscan" class="hacker-btn p-3" data-recon-type="website">[ urlscan.io ]</button>
                            <button id="external-builtwith" class="hacker-btn p-3" data-recon-type="website">[ BuiltWith ]</button>
                            <button id="external-publicwww" class="hacker-btn p-3" data-recon-type="website">[ PublicWWW ]</button>
                            <button id="external-spyonweb" class="hacker-btn p-3" data-recon-type="website">[ SpyOnWeb ]</button>
                            <button id="external-hunter" class="hacker-btn p-3" data-recon-type="website">[ Hunter.io ]</button>
                            <button id="external-emailrep" class="hacker-btn p-3" data-recon-type="all">[ EmailRep.io ]</button>
                            <button id="external-linkedin" class="hacker-btn p-3" data-recon-type="all">[ LinkedIn Search ]</button>
                            <button id="external-crunchbase" class="hacker-btn p-3" data-recon-type="all">[ Crunchbase ]</button>
                            <button id="external-apollo" class="hacker-btn p-3" data-recon-type="all">[ Apollo.io ]</button>
                            <button id="external-greynoise" class="hacker-btn p-3" data-recon-type="website">[ GreyNoise ]</button>
                            <button id="external-whatsmynameweb" class="hacker-btn p-3" data-recon-type="user">[ WhatsMyName ]</button>
                            <button id="external-truecaller" class="hacker-btn p-3" data-recon-type="user">[ Truecaller ]</button>
                            <button id="external-syncme" class="hacker-btn p-3" data-recon-type="user">[ Sync.me ]</button>
                            <button id="external-qwant" class="hacker-btn p-3" data-recon-type="all">[ Qwant ]</button>
                            <button id="external-yandex" class="hacker-btn p-3" data-recon-type="all">[ Yandex ]</button>
                            <button id="external-netcraft" class="hacker-btn p-3" data-recon-type="website">[ Netcraft ]</button>
                            <button id="external-ahmia" class="hacker-btn p-3" data-recon-type="all">[ Ahmia.fi (TOR) ]</button>
                        </div>
                    </div>
                </div>

                <!-- Google Dorking Toggle -->
                <div class="hacker-container p-6 rounded-lg" data-recon-type="website">
                    <div>
                        <button id="toggle-dorking-modules" class="w-full hacker-btn p-3 font-bold text-xl">
                            [ Show Google Dorking Modules ]
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Collapsible Dorking Modules Container -->
        <div id="dorking-modules-container" class="hidden space-y-10" data-recon-type="website">
      
            <!-- Visual Reconnaissance -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Visual Recon (Favicon Pivoting)</h2>
                <div class="hacker-container p-6 rounded-lg space-y-4">
                    <div>
                        <p class="text-gray-400">// Find related infrastructure by searching for the target's favicon hash on Shodan...</p>
                        <button id="favicon-pivot" class="w-full hacker-btn font-bold py-3 px-6 rounded-md mt-4">
                            [ Find by Favicon Hash (Shodan) ]
                        </button>
                        <p class="text-xs text-gray-500 mt-2">// Note: This is a conceptual search. For accurate results, calculate the MurmurHash3 of the favicon and search Shodan for `http.favicon.hash:&lt;hash&gt;`.</p>
                    </div>
                </div>
            </div>

            <!-- AI-Powered Dork Builder -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> AI-Powered Dork Builder</h2>
                <div class="hacker-container p-6 rounded-lg space-y-4">
                    <div>
                        <p class="text-gray-400">// Describe the vulnerability or file you're looking for...</p>
                        <div>
                            <label for="ai-prompt" class="block text-lg font-medium text-cyan-400 mb-2">Request:</label>
                            <input type="text" id="ai-prompt" placeholder="e.g., find exposed Jira dashboards or secrets in Trello boards" class="w-full px-4 py-3 hacker-input rounded-md">
                        </div>
                        <button id="generate-ai-dork" class="w-full hacker-btn font-bold py-3 px-6 rounded-md mt-4">
                            [ Generate Dork ]
                        </button>
                        <p id="ai-loading-message" class="text-cyan-400 mt-2 hidden">>> Generating dork...</p>
                        <div id="ai-result-container" class="hidden mt-4">
                            <label class="block text-lg font-medium text-cyan-400 mb-2">Generated Dork:</label>
                            <div class="bg-black/50 p-4 rounded-md flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border border-cyan-400/50">
                                <p id="ai-dork-output" class="text-white flex-grow whitespace-pre-wrap break-words"></p>
                                <div class="flex flex-row gap-2 self-end sm:self-center">
                                     <button id="copy-ai-dork" class="hacker-btn font-bold py-2 px-4 rounded-md text-sm">Copy</button>
                                     <button id="search-ai-dork" class="hacker-btn font-bold py-2 px-4 rounded-md text-sm bg-cyan-600/50 border-cyan-600">Search</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Basic Recon -->
            <div>
              <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Basic Recon Dorks</h2>
              <div class="dork-grid">
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN'><span class="dork-text">All Indexed Pages</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:*.TARGET_DOMAIN -site:www.TARGET_DOMAIN'><span class="dork-text">Subdomains</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN inurl:login | inurl:signin | intitle:"Login" | intitle:"Sign In"'><span class="dork-text">Login Pages</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"index of"'><span class="dork-text">Open Directories</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
              </div>
            </div>

            <!-- Credentials & Sensitive Keys -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Credentials & Sensitive Keys</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "AWS_ACCESS_KEY_ID" "AKIA"'><span class="dork-text">AWS Keys</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "api_key" | "apikey"'><span class="dork-text">Exposed API Keys</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN filetype:env "DB_PASSWORD"'><span class="dork-text">Public .env Files</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "password" filetype:log'><span class="dork-text">Passwords in Logs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"index of" ".ssh"'><span class="dork-text">Exposed SSH Dirs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN inurl:id_rsa -github'><span class="dork-text">Exposed SSH Keys</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>
            
            <!-- Backup Files -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Backups & Database Dumps</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN ext:sql | ext:db | ext:mdb | ext:backup | ext:bak | ext:dump'><span class="dork-text">DB Backups & Dumps</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "Index of /" "backup"'><span class="dork-text">Backup Directories</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN filetype:zip | filetype:tar "backup"'><span class="dork-text">Compressed Backups</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>

            <!-- Sensitive Files -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Sensitive Documents</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "Internal use only" | "confidential"'><span class="dork-text">Internal / Confidential</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN ext:pdf | ext:doc | ext:docx "invoice" "paid"'><span class="dork-text">Receipts & Invoices</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN ext:xls | ext:xlsx "salary"'><span class="dork-text">Salary Spreadsheets</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>

            <!-- Vulnerable Files & Server Info -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Vulnerable Files & Server Info</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"apache tomcat" "administration"'><span class="dork-text">Tomcat Admin</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"index of" "ws_ftp.log"'><span class="dork-text">WS_FTP Logs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN filetype:log "inurl:wp-content"'><span class="dork-text">WordPress Debug Logs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>

            <!-- Test Endpoints & Errors -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Test Endpoints & Errors</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:*.dev.TARGET_DOMAIN | site:*.stage.TARGET_DOMAIN | site:*.test.TARGET_DOMAIN'><span class="dork-text">Dev/Staging Subdomains</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "PHP Fatal error" | "PHP Warning"'><span class="dork-text">PHP Errors</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='intext:"sql syntax near" | intext:"syntax error has occurred" site:TARGET_DOMAIN'><span class="dork-text">SQL Errors</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN inurl:/proc/self/cwd'><span class="dork-text">LFI/Path Traversal</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>
        </div>

      </div>
    </main>

    <footer class="text-center mt-12 text-gray-500">
      <p>// Happy Hacking! Use responsibly and with authorization. //</p>
      <p class="mt-4 text-sm italic">Made with <span class="text-red-500">&hearts;</span> by 4n1_1p4m</p>
    </footer>
  </div>
  
  <!-- Live2D Widget Settings -->
  <script>
    var live2d_settings = {
        "display": {
            "position": "right",
            "width": 132,
            "height": 265,
            "hOffset": 0,
            "vOffset": -20
        }
    };
  </script>

  <!-- Live2D Widget Script -->
  <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const targetInput = document.getElementById('target-input');
      const errorMessage = document.getElementById('error-message');
      const dorkItems = document.querySelectorAll('.dork-item');
      const clearButton = document.getElementById('clear-target');
      
      const reconModeTabs = document.querySelectorAll('#recon-mode-tabs .tab-btn');
      const reconModules = document.querySelectorAll('[data-recon-type]');

      const generateAiDorkBtn = document.getElementById('generate-ai-dork');
      const aiPromptInput = document.getElementById('ai-prompt');
      const aiResultContainer = document.getElementById('ai-result-container');
      const aiDorkOutput = document.getElementById('ai-dork-output');
      const copyAiDorkBtn = document.getElementById('copy-ai-dork');
      const searchAiDorkBtn = document.getElementById('search-ai-dork');
      const aiLoadingMessage = document.getElementById('ai-loading-message');

      // Profiler Elements
      const initiateProfileBtn = document.getElementById('initiate-profile');
      const profilerResultsContainer = document.getElementById('profiler-results-container');
      const profilerStatus = document.getElementById('profiler-status');
      const profilerResultsList = document.getElementById('profiler-results-list');
      
      // Visual Recon & Tech Stack Elements
      const faviconPivotBtn = document.getElementById('favicon-pivot');
      const identifyTechBtn = document.getElementById('identify-tech');
      const techResultsContainer = document.getElementById('tech-results-container');
      const techStatus = document.getElementById('tech-status');
      const techResultsList = document.getElementById('tech-results-list');

      // External Recon Elements
      const externalButtons = {
        'external-github': { url: 'https://github.com/search?q="TARGET_QUERY"&type=code', name: 'GitHub Search' },
        'external-pastebin': { url: 'https://www.google.com/search?q=site:pastebin.com "TARGET_QUERY"', name: 'Pastebin Search' },
        'external-virustotal': { url: 'https://www.virustotal.com/gui/domain/TARGET_QUERY', name: 'VirusTotal' },
        'external-securitytrails': { url: 'https://securitytrails.com/domain/TARGET_QUERY/dns', name: 'SecurityTrails' },
        'external-wayback': { url: 'https://web.archive.org/web/*/TARGET_QUERY', name: 'Waybackurls' },
        'external-censys': { url: 'https://search.censys.io/search?resource=hosts&q=TARGET_QUERY', name: 'Censys' },
        'external-crtsh': { url: 'https://crt.sh/?q=TARGET_QUERY', name: 'crt.sh' },
        'external-dnsdumpster': { url: 'https://dnsdumpster.com/', name: 'DNSdumpster' },
        'external-hunter': { url: 'https://hunter.io/search?domain=TARGET_QUERY', name: 'Hunter.io' },
        'external-passivetotal': { url: 'https://community.riskiq.com/search/TARGET_QUERY', name: 'PassiveTotal' },
        'external-linkedin': { url: 'https://www.google.com/search?q=site:linkedin.com/in "TARGET_QUERY"', name: 'LinkedIn Search' },
        'external-emailrep': { url: 'https://emailrep.io/', name: 'EmailRep.io' },
        'external-urlscan': { url: 'https://urlscan.io/search/#TARGET_QUERY', name: 'urlscan.io' },
        'external-viewdns': { url: 'https://viewdns.info/whois/?domain=TARGET_QUERY', name: 'ViewDNS.info' },
        'external-whois': { url: 'https://who.is/whois/TARGET_QUERY', name: 'who.is' },
        'external-leakix': { url: 'https://leakix.net/search?q=TARGET_QUERY', name: 'LeakIX' },
        'external-searchcode': { url: 'https://searchcode.com/?q=TARGET_QUERY', name: 'Searchcode' },
        'external-grepapp': { url: 'https://grep.app/?q=TARGET_QUERY', name: 'Grep.app' },
        'external-fofa': { url: 'https://en.fofa.info/result?qbase64=FOFA_B64_QUERY', name: 'FOFA' },
        'external-zoomeye': { url: 'https://www.zoomeye.org/searchResult?q=TARGET_QUERY', name: 'ZoomEye' },
        'external-netlas': { url: 'https://app.netlas.io/host/?q=TARGET_QUERY', name: 'Netlas.io' },
        'external-builtwith': { url: 'https://builtwith.com/?TARGET_QUERY', name: 'BuiltWith' },
        'external-publicwww': { url: 'https://publicwww.com/websites/%22TARGET_QUERY%22/', name: 'PublicWWW' },
        'external-spyonweb': { url: 'http://spyonweb.com/TARGET_QUERY', name: 'SpyOnWeb' },
        'external-grayhat': { url: 'https://buckets.grayhatwarfare.com/', name: 'Grayhat Warfare' },
        'external-rapiddns': { url: 'https://rapiddns.io/subdomain/TARGET_QUERY', name: 'RapidDNS' },
        'external-ptrarchive': { url: 'http://ptrarchive.com/tools/search.htm?label=TARGET_QUERY', name: 'PTR Archive' },
        'external-dnslytics': { url: 'https://dnslytics.com/domain/TARGET_QUERY', name: 'DNSlytics' },
        'external-domainbigdata': { url: 'https://domainbigdata.com/TARGET_QUERY', name: 'DomainBigData' },
        'external-dehashed': { url: 'https://www.dehashed.com/search?query=domain%3ATARGET_QUERY', name: 'Dehashed' },
        'external-scylla': { url: 'https://scylla.sh/search', name: 'Scylla.sh' },
        'external-haveibeenpwned': { url: 'https://haveibeenpwned.com/', name: 'HaveIBeenPwned' },
        'external-crunchbase': { url: 'https://www.crunchbase.com/textsearch?q=TARGET_QUERY', name: 'Crunchbase' },
        'external-apollo': { url: 'https://www.apollo.io/search/companies?q=TARGET_QUERY', name: 'Apollo.io' },
        'external-greynoise': { url: 'https://viz.greynoise.io/query?gnql=TARGET_QUERY', name: 'GreyNoise' },
        'external-qwant': { url: 'https://www.qwant.com/?q=TARGET_QUERY&t=web', name: 'Qwant' },
        'external-yandex': { url: 'https://yandex.com/search/?text=TARGET_QUERY', name: 'Yandex' },
        'external-netcraft': { url: 'https://search.netcraft.com/?q=TARGET_QUERY', name: 'Netcraft' },
        'external-ahmia': { url: 'https://ahmia.fi/search/?q=TARGET_QUERY', name: 'Ahmia.fi' },
        'external-dnsdb': { url: 'https://dnsdb.io/', name: 'DNSDB' },
        'external-securityheaders': { url: 'https://securityheaders.com/?q=TARGET_QUERY&followRedirects=on', name: 'SecurityHeaders.io' },
        'external-whatsmynameweb': { url: 'https://whatsmyname.app/?q=TARGET_QUERY', name: 'WhatsMyName' },
        'external-truecaller': { url: 'https://www.truecaller.com/search/in/TARGET_QUERY', name: 'Truecaller' },
        'external-syncme': { url: 'https://sync.me/search/?number=TARGET_QUERY', name: 'Sync.me' }
      };
      
      // Dorking Modules Toggle
      const toggleDorkingBtn = document.getElementById('toggle-dorking-modules');
      const dorkingContainer = document.getElementById('dorking-modules-container');

      // History Elements
      const historyContainer = document.getElementById('history-container');
      const clearHistoryBtn = document.getElementById('clear-history');
      let history = JSON.parse(localStorage.getItem('nexusReconHistory')) || [];
      
      // Workspace Elements
      const workspaceSubdomains = document.getElementById('workspace-subdomains');
      const workspaceEmails = document.getElementById('workspace-emails');
      const workspaceIps = document.getElementById('workspace-ips');
      const workspaceUrls = document.getElementById('workspace-urls');
      const workspaceNotes = document.getElementById('workspace-notes');
      const clearWorkspaceBtn = document.getElementById('clear-workspace');
      const workspaceElements = [workspaceSubdomains, workspaceEmails, workspaceIps, workspaceUrls, workspaceNotes];

      const getActiveTarget = () => {
          return { value: targetInput.value.trim(), element: targetInput };
      };

      const handleMissingTarget = () => {
          const { element } = getActiveTarget();
          errorMessage.textContent = 'ERROR: Target required for this action.';
          errorMessage.classList.remove('hidden');
          element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          element.classList.add('shake-error');
          setTimeout(() => {
              element.classList.remove('shake-error');
          }, 820); // Duration of the shake animation
      };
      
      const addHistoryEntry = (action, target, note = '') => {
          const timestamp = new Date();
          const entry = {
              id: timestamp.getTime(),
              time: timestamp.toLocaleTimeString(),
              action,
              target,
              note
          };
          history.unshift(entry);
          if (history.length > 50) history.pop(); // Limit history size
          localStorage.setItem('nexusReconHistory', JSON.stringify(history));
          renderHistory();
      };
      
      const renderHistory = () => {
          if (!historyContainer) return;
          historyContainer.innerHTML = '';
          if (history.length === 0) {
              historyContainer.innerHTML = '<p class="text-gray-500 italic">// No activity yet...</p>';
              return;
          }
          history.forEach(entry => {
              const entryEl = document.createElement('div');
              entryEl.className = 'bg-black/30 p-3 rounded-md border border-fuchsia-500/30';
              entryEl.innerHTML = `
                  <div class="flex justify-between items-center">
                      <p class="text-sm"><span class="text-gray-500">[${entry.time}]</span> Used <span class="text-fuchsia-400">${entry.action}</span> on <span class="text-cyan-400">${entry.target}</span></p>
                  </div>
                  <textarea class="note-input w-full mt-2 p-2 text-xs rounded-md bg-black/50 border-fuchsia-500/50" data-id="${entry.id}" placeholder="// Add notes...">${entry.note}</textarea>
              `;
              historyContainer.appendChild(entryEl);
          });
      };

      if (historyContainer) {
        historyContainer.addEventListener('change', (e) => {
            if (e.target.classList.contains('note-input')) {
                const entryId = Number(e.target.dataset.id);
                const entry = history.find(item => item.id === entryId);
                if (entry) {
                    entry.note = e.target.value;
                    localStorage.setItem('nexusReconHistory', JSON.stringify(history));
                }
            }
        });
      }

      if (clearHistoryBtn) {
        clearHistoryBtn.addEventListener('click', () => {
            history = [];
            localStorage.removeItem('nexusReconHistory');
            renderHistory();
        });
      }

      const executeDork = (event) => {
        if (event.target.classList.contains('copy-btn')) return;
        const { value: domain } = getActiveTarget();
        if (!domain) {
          handleMissingTarget();
          return;
        }
        errorMessage.classList.add('hidden');
        const dorkButton = event.currentTarget.querySelector('button[data-dork]');
        const dorkTemplate = dorkButton.getAttribute('data-dork');
        if (dorkTemplate) {
          const finalDork = dorkTemplate.replace(/TARGET_DOMAIN/g, domain);
          addHistoryEntry(`Dork: ${dorkButton.textContent.trim()}`, domain);
          window.open(`https://www.google.com/search?q=${encodeURIComponent(finalDork)}`, '_blank');
        }
      };

      const copyDork = (copyBtn) => {
        const { value: domain } = getActiveTarget();
        if (!domain) {
          handleMissingTarget();
          return;
        }
        errorMessage.classList.add('hidden');
        const dorkBtn = copyBtn.closest('.dork-item').querySelector('button[data-dork]');
        const dorkTemplate = dorkBtn.getAttribute('data-dork');
        const finalDork = dorkTemplate.replace(/TARGET_DOMAIN/g, domain);
        
        const textArea = document.createElement('textarea');
        textArea.value = finalDork;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            copyBtn.textContent = 'Copied!';
        } catch (err) {
            console.error('Failed to copy text: ', err);
            copyBtn.textContent = 'Error!';
        }
        document.body.removeChild(textArea);

        setTimeout(() => copyBtn.textContent = 'Copy', 1500);
      };

      dorkItems.forEach(item => {
        item.addEventListener('click', executeDork);
        
        const copyButton = item.querySelector('.copy-btn');
        if (copyButton) {
            copyButton.addEventListener('click', (e) => {
                e.stopPropagation();
                copyDork(copyButton);
            });
        }
      });

      if (clearButton) {
        clearButton.addEventListener('click', (e) => {
          e.stopPropagation();
          const { element } = getActiveTarget();
          element.value = '';
          errorMessage.classList.add('hidden');
        });
      }

      const typeEffect = (element, text, speed = 50, callback) => {
        element.textContent = "";
        let i = 0;
        const timer = setInterval(() => {
            if (i < text.length) {
                element.textContent += text.charAt(i);
                i++;
            } else {
                clearInterval(timer);
                if (callback) callback();
            }
        }, speed);
      };

      // --- Automated Profiler Logic ---
      const runProfiler = () => {
          const { value: target } = getActiveTarget();
          if (!target) {
              handleMissingTarget();
              return;
          }
          addHistoryEntry('Automated Profiler', target);
          errorMessage.classList.add('hidden');
          profilerResultsContainer.classList.remove('hidden');
          profilerResultsList.innerHTML = ''; // Clear previous results

          const profilerDorks = [
              { name: 'Subdomain Scan', dork: 'site:*.TARGET_DOMAIN -site:www.TARGET_DOMAIN' },
              { name: 'Login Portals', dork: 'site:TARGET_DOMAIN inurl:login | inurl:signin' },
              { name: 'Config Files', dork: 'site:TARGET_DOMAIN ext:xml | ext:conf | ext:ini | ext:log' },
              { name: 'Public Cloud Buckets', dork: 'site:s3.amazonaws.com "TARGET_DOMAIN"' },
              { name: 'Exposed Docs', dork: 'site:TARGET_DOMAIN ext:pdf | ext:docx "confidential"' }
          ];

          typeEffect(profilerStatus, `>> Profile for [${target}] complete:`, 30, () => {
              profilerDorks.forEach((item, index) => {
                  setTimeout(() => {
                      const finalDork = item.dork.replace(/TARGET_DOMAIN/g, target);
                      const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(finalDork)}`;
                      
                      const resultItem = document.createElement('div');
                      resultItem.className = 'flex justify-between items-center';
                      resultItem.innerHTML = `
                          <span>- ${item.name}.......</span>
                          <a href="${searchUrl}" target="_blank" class="hacker-btn text-sm px-3 py-1 rounded-md">[ View Results ]</a>
                      `;
                      profilerResultsList.appendChild(resultItem);
                  }, index * 100); // Staggered appearance
              });
          });
      };

      if (initiateProfileBtn) initiateProfileBtn.addEventListener('click', runProfiler);
      
      // --- Favicon Pivot Logic ---
      if (faviconPivotBtn) {
        faviconPivotBtn.addEventListener('click', () => {
            const { value: target } = getActiveTarget();
            if (!target) {
                handleMissingTarget();
                return;
            }
            addHistoryEntry('Favicon Pivot', target);
            const shodanDork = `http.html:"${target}"`;
            const shodanUrl = `https://www.shodan.io/search?query=${encodeURIComponent(shodanDork)}`;
            window.open(shodanUrl, '_blank');
        });
      }

      // --- Tech Stack Identifier Logic ---
      const identifyTechStack = () => {
          const { value: target } = getActiveTarget();
          if (!target) {
              handleMissingTarget();
              return;
          }
          addHistoryEntry('Tech-Stack Identifier', target);
          techResultsContainer.classList.remove('hidden');
          techResultsList.innerHTML = '';

          const techDorks = [
              { name: 'WordPress', dork: 'site:TARGET_DOMAIN inurl:wp-content | inurl:wp-admin' },
              { name: 'Joomla', dork: 'site:TARGET_DOMAIN intext:"Powered by Joomla"' },
              { name: 'Drupal', dork: 'site:TARGET_DOMAIN intext:"Powered by Drupal"' },
              { name: 'Shopify', dork: 'site:TARGET_DOMAIN inurl:myshopify.com' },
              { name: 'Apache Struts', dork: 'site:TARGET_DOMAIN filetype:action | filetype:do' },
              { name: 'Adobe AEM', dork: 'site:TARGET_DOMAIN inurl:/content/dam' }
          ];

          typeEffect(techStatus, `>> Tech stack scan for [${target}] complete:`, 30, () => {
              techDorks.forEach((tech, index) => {
                  setTimeout(() => {
                      const finalDork = tech.dork.replace(/TARGET_DOMAIN/g, target);
                      const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(finalDork)}`;
                      
                      const resultItem = document.createElement('div');
                      resultItem.className = 'flex justify-between items-center';
                      resultItem.innerHTML = `
                          <span>- ${tech.name}.......</span>
                          <a href="${searchUrl}" target="_blank" class="hacker-btn text-sm px-3 py-1 rounded-md">[ Check ]</a>
                      `;
                      techResultsList.appendChild(resultItem);
                  }, index * 100);
              });
          });
      };
      
      if (identifyTechBtn) identifyTechBtn.addEventListener('click', identifyTechStack);

      // --- External Recon Logic ---
      const openExternalTool = (urlTemplate, toolName) => {
        const { value: target } = getActiveTarget();
        if(!target) {
          handleMissingTarget();
          return;
        }
        addHistoryEntry(toolName, target);
        let query = target;
        // Special handling for FOFA which requires base64
        if (urlTemplate.includes('FOFA_B64_QUERY')) {
            query = btoa(`domain="${target}"`);
            urlTemplate = urlTemplate.replace('FOFA_B64_QUERY', query);
        } else {
            urlTemplate = urlTemplate.replace('TARGET_QUERY', encodeURIComponent(query));
        }
        window.open(urlTemplate, '_blank');
      };

      for (const [id, tool] of Object.entries(externalButtons)) {
        const btn = document.getElementById(id);
        if (btn) {
            btn.addEventListener('click', () => openExternalTool(tool.url, tool.name));
        }
      }

      // --- Dorking Modules Toggle Logic ---
      if (toggleDorkingBtn) {
        toggleDorkingBtn.addEventListener('click', () => {
            const wasHidden = dorkingContainer.classList.contains('hidden');
            dorkingContainer.classList.toggle('hidden');
            
            if (wasHidden) {
                toggleDorkingBtn.textContent = '[ Hide Google Dorking Modules ]';
                // Scroll to the container after a tiny delay to ensure it's rendered
                setTimeout(() => {
                    dorkingContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100); 
            } else {
                toggleDorkingBtn.textContent = '[ Show Google Dorking Modules ]';
            }
        });
      }

      // --- Gemini AI Dork Generation Logic ---
      const generateAiDork = async () => {
          const { value: domain } = getActiveTarget();
          const userRequest = aiPromptInput.value.trim();
          if (!domain || !userRequest) {
              handleMissingTarget();
              if (domain && !userRequest) {
                  errorMessage.textContent = 'ERROR: AI request description is missing.';
              }
              return;
          }
          generateAiDorkBtn.disabled = true;
          aiLoadingMessage.classList.remove('hidden');
          aiResultContainer.classList.add('hidden');
          errorMessage.classList.add('hidden');

          const prompt = `You are an expert security researcher specializing in Google Dorking for bug bounty hunting. Your task is to generate a single, precise, and effective Google Dork query.
Rules:
- The output must be ONLY the dork query itself.
- Do not include any explanations, introductory text, or markdown formatting like \`\`\`.
- The dork must be tailored to the user's request and the specified target. The target can be a domain or a company name.
- Use advanced operators like site:, inurl:, intitle:, filetype:, ext:, etc., where appropriate.
- If the user asks for something general like "vulnerabilities", create a dork for a common, high-impact finding like exposed config files or sensitive documents.

Target: "${domain}"
User's Request: "${userRequest}"

Generate the Google Dork:`;

          const maxRetries = 3;
          for (let attempt = 0; attempt < maxRetries; attempt++) {
              try {
                  const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                  const apiKey = ""; 
                  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                  
                  const response = await fetch(apiUrl, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(payload)
                  });

                  if (!response.ok) {
                      if (response.status >= 400 && response.status < 500) {
                          console.error(`Client error: ${response.status}. Not retrying.`);
                          throw new Error(`API request failed with status ${response.status}`);
                      }
                      throw new Error(`API request failed with server error: ${response.status}`);
                  }

                  const result = await response.json();

                  if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                      const generatedDork = result.candidates[0].content.parts[0].text.trim();
                      aiResultContainer.classList.remove('hidden');
                      typeEffect(aiDorkOutput, generatedDork, 30);
                      generateAiDorkBtn.disabled = false;
                      aiLoadingMessage.classList.add('hidden');
                      addHistoryEntry('AI Dork Generation', domain, `Request: ${userRequest}`);
                      return; 
                  } else {
                      throw new Error('Invalid response structure from API.');
                  }

              } catch (error) {
                  console.error(`Attempt ${attempt + 1} failed:`, error.message);
                  if (attempt + 1 >= maxRetries) {
                      aiDorkOutput.textContent = 'ERROR: AI service unavailable. Please try again later.';
                      aiResultContainer.classList.remove('hidden');
                  } else {
                      const delay = Math.pow(2, attempt) * 1000;
                      await new Promise(res => setTimeout(res, delay));
                  }
              }
          }
          
          generateAiDorkBtn.disabled = false;
          aiLoadingMessage.classList.add('hidden');
      };

      if (generateAiDorkBtn) generateAiDorkBtn.addEventListener('click', generateAiDork);

      if (copyAiDorkBtn) {
        copyAiDorkBtn.addEventListener('click', () => {
            const dorkToCopy = aiDorkOutput.textContent;
            const textArea = document.createElement('textarea');
            textArea.value = dorkToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyAiDorkBtn.textContent = 'Copied!';
            } catch (err) {
                console.error('Failed to copy text: ', err);
                copyAiDorkBtn.textContent = 'Error!';
            }
            document.body.removeChild(textArea);
            setTimeout(() => copyAiDorkBtn.textContent = 'Copy', 1500);
        });
      }

      if (searchAiDorkBtn) {
        searchAiDorkBtn.addEventListener('click', () => {
            const dorkToSearch = aiDorkOutput.textContent;
            if (dorkToSearch) {
                window.open(`https://www.google.com/search?q=${encodeURIComponent(dorkToSearch)}`, '_blank');
            }
        });
      }
      
      // --- Workspace Logic ---
      const saveWorkspaceData = () => {
          const { value: target } = getActiveTarget();
          if (!target) return;
          const data = {
              subdomains: workspaceSubdomains.value,
              emails: workspaceEmails.value,
              ips: workspaceIps.value,
              urls: workspaceUrls.value,
              notes: workspaceNotes.value,
          };
          localStorage.setItem(`nexusWorkspace_${target}`, JSON.stringify(data));
      };

      const loadWorkspaceData = () => {
          const { value: target } = getActiveTarget();
          const data = JSON.parse(localStorage.getItem(`nexusWorkspace_${target}`)) || {};
          workspaceSubdomains.value = data.subdomains || '';
          workspaceEmails.value = data.emails || '';
          workspaceIps.value = data.ips || '';
          workspaceUrls.value = data.urls || '';
          workspaceNotes.value = data.notes || '';
      };

      if (targetInput) targetInput.addEventListener('input', loadWorkspaceData);
      workspaceElements.forEach(el => {
          if (el) el.addEventListener('input', saveWorkspaceData);
      });
      
      if (clearWorkspaceBtn) {
        clearWorkspaceBtn.addEventListener('click', () => {
            const { value: target } = getActiveTarget();
            if (target) {
                localStorage.removeItem(`nexusWorkspace_${target}`);
                loadWorkspaceData(); // This will clear the fields
            }
        });
      }

      // --- Recon Mode Switching Logic ---
      reconModeTabs.forEach(tab => {
          tab.addEventListener('click', () => {
              reconModeTabs.forEach(t => t.classList.remove('active'));
              tab.classList.add('active');
              
              const mode = tab.dataset.mode;
              if (mode === 'website') {
                  targetInput.placeholder = 'Enter Domain or Company...';
              } else {
                  targetInput.placeholder = 'Enter Username, Email, or Phone...';
              }

              reconModules.forEach(module => {
                  const type = module.dataset.reconType;
                  if (type === 'all' || type === mode) {
                      module.style.display = '';
                  } else {
                      module.style.display = 'none';
                  }
              });
              loadWorkspaceData(); // Load data for the new active target
          });
      });
      
      // Initial render of history and workspace on load
      renderHistory();
      loadWorkspaceData();
    });
  </script>

</body>
</html>

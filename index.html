<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NexusRecon - Advanced Recon Framework</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Cyberpunk Favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%230a0a1a;stroke:%2300ffdd;stroke-miterlimit:10;stroke-width:3px;%7D.cls-2%7Bfill:%23ff00c1;%7D%3C/style%3E%3C/defs%3E%3Cpath class='cls-1' d='M50,5A45,45,0,1,1,5,50,45,45,0,0,1,50,5Z'/%3E%3Ccircle class='cls-2' cx='50' cy='50' r='15'/%3E%3Cpath class='cls-1' d='M25,50a25,25,0,0,1,50,0'/%3E%3C/svg%3E" type="image/svg+xml">
  <style>
    :root {
        --primary-color: #00ffdd;
        --accent-color: #ff00c1;
        --bg-color: #0a0a1a;
        --text-glow-color: rgba(0, 255, 221, 0.4);
        --grid-color: rgba(0, 221, 255, 0.1);
    }

    body.theme-matrix {
        --primary-color: #00ff41;
        --accent-color: #00ff41;
        --bg-color: #000;
        --text-glow-color: rgba(0, 255, 65, 0.4);
        --grid-color: rgba(0, 255, 65, 0.1);
    }
    
    @keyframes grid-pan {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }

    body {
      font-family: 'Fira Code', monospace;
      background-color: var(--bg-color);
      color: var(--primary-color);
      overflow-x: hidden;
      background-image: 
        linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
      background-size: 40px 40px;
      animation: grid-pan 120s linear infinite;
      cursor: none;
      text-shadow: 0 0 3px var(--text-glow-color);
    }

    body.no-grid-animation {
        animation: none;
    }
    
    a, button, .copy-btn, .hacker-btn {
        cursor: none;
    }

    .hacker-container {
        position: relative;
        border: 1px solid var(--accent-color);
        box-shadow: 0 0 15px var(--accent-color-translucent, rgba(255, 0, 193, 0.3)), inset 0 0 10px var(--accent-color-translucent-inner, rgba(255, 0, 193, 0.15));
        background-color: rgba(10, 10, 26, 0.85);
        backdrop-filter: blur(8px);
    }

    /* HUD Corner Brackets */
    .hacker-container::before, .hacker-container::after,
    .hacker-container > :first-child::before, .hacker-container > :first-child::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        border-color: var(--primary-color);
        border-style: solid;
        transition: all 0.3s ease;
    }
    .hacker-container:hover::before, .hacker-container:hover::after,
    .hacker-container:hover > :first-child::before, .hacker-container:hover > :first-child::after {
        border-color: var(--accent-color);
    }
    .hacker-container::before { top: -2px; left: -2px; border-width: 2px 0 0 2px; }
    .hacker-container::after { top: -2px; right: -2px; border-width: 2px 2px 0 0; }
    .hacker-container > :first-child::before { bottom: -2px; left: -2px; border-width: 0 0 2px 2px; }
    .hacker-container > :first-child::after { bottom: -2px; right: -2px; border-width: 0 2px 2px 0; }

    /* New Neon Glitch Animation */
    .glitch {
        position: relative;
        font-weight: 700;
        color: #c0c0c0;
        letter-spacing: 0.1em;
        animation: glitch-main 12s infinite linear alternate;
        text-shadow: 
            0 0 1px #fff,
            0 0 5px #00aaff,
            0 0 10px #00aaff,
            0 0 20px #9900ff,
            0 0 30px #9900ff,
            0 0 40px var(--accent-color),
            0 0 55px var(--accent-color);
    }
    
    body.no-logo-animation .glitch {
        animation: none;
    }
    body.no-logo-animation .glitch::before,
    body.no-logo-animation .glitch::after {
        display: none;
    }

    .glitch::before,
    .glitch::after {
        content: attr(data-text);
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .glitch::before {
        left: 2px;
        text-shadow: -2px 0 var(--accent-color);
        animation: glitch-before 12s infinite linear alternate;
    }

    .glitch::after {
        left: -2px;
        text-shadow: -2px 0 #00aaff, 2px 2px #9900ff;
        animation: glitch-after 12s infinite linear alternate;
    }

    @keyframes glitch-main { 0% { opacity: 1; } 94% { opacity: 1; } 95% { opacity: 0.3; } 96% { opacity: 1; } 98% { opacity: 0.3; } 100% { opacity: 1; } }
    @keyframes glitch-before { 0% { clip-path: inset(89% -6px 8% 0); transform: skew(0.9deg); } 5% { clip-path: inset(41% -6px 56% 0); transform: skew(0.2deg); } 10% { clip-path: inset(2% -6px 89% 0); transform: skew(0.5deg); } 15% { clip-path: inset(78% -6px 1% 0); transform: skew(0.1deg); } 20% { clip-path: inset(33% -6px 62% 0); transform: skew(0.7deg); } 25% { clip-path: inset(55% -6px 10% 0); transform: skew(0.8deg); } 30% { clip-path: inset(89% -6px 8% 0); transform: skew(0.3deg); } 35% { clip-path: inset(10% -6px 80% 0); transform: skew(0.1deg); } 40% { clip-path: inset(40% -6px 40% 0); transform: skew(0.4deg); } 45% { clip-path: inset(20% -6px 70% 0); transform: skew(0.2deg); } 50% { clip-path: inset(99% -6px 1% 0); transform: skew(0.6deg); } 55% { clip-path: inset(5% -6px 85% 0); transform: skew(0.9deg); } 60% { clip-path: inset(30% -6px 60% 0); transform: skew(0.1deg); } 65% { clip-path: inset(80% -6px 10% 0); transform: skew(0.5deg); } 70% { clip-path: inset(15% -6px 75% 0); transform: skew(0.3deg); } 75% { clip-path: inset(60% -6px 30% 0); transform: skew(0.7deg); } 80% { clip-path: inset(95% -6px 2% 0); transform: skew(0.2deg); } 85% { clip-path: inset(25% -6px 65% 0); transform: skew(0.8deg); } 90% { clip-path: inset(70% -6px 20% 0); transform: skew(0.4deg); } 95% { clip-path: inset(10% -6px 88% 0); transform: skew(0.1deg); } 100% { clip-path: inset(50% -6px 45% 0); transform: skew(0.6deg); } }
    @keyframes glitch-after { 0% { clip-path: inset(89% 0 8% -6px); transform: skew(-0.9deg); } 5% { clip-path: inset(41% 0 56% -6px); transform: skew(-0.2deg); } 10% { clip-path: inset(2% 0 89% -6px); transform: skew(-0.5deg); } 15% { clip-path: inset(78% 0 1% -6px); transform: skew(-0.1deg); } 20% { clip-path: inset(33% 0 62% -6px); transform: skew(-0.7deg); } 25% { clip-path: inset(55% 0 10% -6px); transform: skew(-0.8deg); } 30% { clip-path: inset(89% 0 8% -6px); transform: skew(-0.3deg); } 35% { clip-path: inset(10% 0 80% -6px); transform: skew(-0.1deg); } 40% { clip-path: inset(40% 0 40% -6px); transform: skew(-0.4deg); } 45% { clip-path: inset(20% 0 70% -6px); transform: skew(-0.2deg); } 50% { clip-path: inset(99% 0 1% -6px); transform: skew(-0.6deg); } 55% { clip-path: inset(5% 0 85% -6px); transform: skew(-0.9deg); } 60% { clip-path: inset(30% 0 60% -6px); transform: skew(-0.1deg); } 65% { clip-path: inset(80% 0 10% -6px); transform: skew(-0.5deg); } 70% { clip-path: inset(15% 0 75% -6px); transform: skew(-0.3deg); } 75% { clip-path: inset(60% 0 30% -6px); transform: skew(-0.7deg); } 80% { clip-path: inset(95% 0 2% -6px); transform: skew(-0.2deg); } 85% { clip-path: inset(25% 0 65% -6px); transform: skew(-0.8deg); } 90% { clip-path: inset(70% 0 20% -6px); transform: skew(-0.4deg); } 95% { clip-path: inset(10% 0 88% -6px); transform: skew(-0.1deg); } 100% { clip-path: inset(50% 0 45% -6px); transform: skew(-0.6deg); } }

    .hacker-input, .note-input, .workspace-textarea, .hacker-select { background-color: rgba(0, 221, 255, 0.05); border: 1px solid var(--primary-color); color: var(--primary-color); transition: all 0.3s ease; }
    .hacker-input:focus, .note-input:focus, .workspace-textarea:focus, .hacker-select:focus { outline: none; box-shadow: 0 0 10px var(--primary-color), 0 0 15px var(--accent-color); background-color: rgba(0, 221, 255, 0.1); }
    .hacker-btn:focus-visible, .tab-btn:focus-visible, .dork-item button:focus-visible { outline: none; box-shadow: 0 0 15px var(--accent-color), 0 0 5px var(--accent-color) inset; }
    .hacker-select option { background-color: var(--bg-color); color: var(--primary-color); }
    .hacker-btn { background-color: transparent; border: 1px solid var(--primary-color); color: var(--primary-color); text-shadow: 0 0 5px var(--primary-color); transition: all 0.3s ease; position: relative; overflow: hidden; will-change: transform; }
    .hacker-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(120deg, transparent, rgba(0, 221, 255, 0.4), transparent); transition: all 0.5s; }
    .hacker-btn:hover::before { left: 100%; }
    .hacker-btn:hover { background-color: var(--primary-color); color: var(--bg-color); box-shadow: 0 0 20px var(--primary-color); }
    .category-title { color: var(--accent-color); text-shadow: 0 0 8px var(--accent-color); }
    .subcategory-title { color: var(--primary-color); text-shadow: 0 0 5px var(--primary-color); }
    .dork-item { border: 1px solid rgba(255, 0, 193, 0.5); transition: all 0.3s ease; position: relative; }
    .dork-item:hover { border-color: var(--accent-color); box-shadow: 0 0 10px rgba(255, 0, 193, 0.5); transform: translateY(-3px); }
    .dork-text { color: var(--primary-color); }
    .dork-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; }
    @keyframes shake-error-animation { 10%, 90% { transform: translateX(-1px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }
    .shake-error { animation: shake-error-animation 0.82s cubic-bezier(.36,.07,.19,.97) both; }
    .tab-btn { background-color: transparent; border: 1px solid var(--primary-color); color: var(--primary-color); transition: all 0.3s ease; }
    .tab-btn.active { background-color: var(--primary-color); color: var(--bg-color); box-shadow: 0 0 15px var(--primary-color); }
    
    /* Panel Styles */
    .side-panel { 
        position: fixed; 
        bottom: 1rem; 
        transform: translateX(-120%); 
        opacity: 0; 
        pointer-events: none; 
        width: 90vw; 
        max-width: 500px; 
        max-height: 80vh; 
        transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1); 
        z-index: 1000; 
        overflow-x: hidden; /* Added to prevent horizontal scrollbars */
    }
    .side-panel.open { transform: translateX(0); opacity: 1; pointer-events: auto; }
    #notes-panel { left: 1rem; }
    #settings-panel { left: 1rem; }
    #history-panel { left: 1rem; }


    .floating-btn { position: fixed; z-index: 999; }
    #settings-toggle { left: 1rem; bottom: 1rem; }
    #history-toggle { left: 1rem; bottom: 6rem; }
    #notes-toggle { left: 1rem; bottom: 11rem; }


    #live2d-widget canvas { filter: hue-rotate(220deg) saturate(1.5) drop-shadow(0 0 8px var(--accent-color)); transition: filter 0.5s ease; }
    #live2d-widget canvas:hover { filter: hue-rotate(280deg) saturate(2) drop-shadow(0 0 12px var(--primary-color)); }
    .content-hidden { filter: blur(8px); pointer-events: none; transition: filter 0.3s ease; }
    .cursor { width: 30px; height: 30px; border: 2px solid var(--accent-color); border-radius: 50%; position: fixed; pointer-events: none; transform: translate(-50%, -50%); z-index: 10003; transition: transform 0.1s ease-out; box-shadow: 0 0 10px var(--accent-color), 0 0 20px var(--accent-color), inset 0 0 5px var(--accent-color); display: flex; justify-content: center; align-items: center; }
    .cursor::before, .cursor::after { content: ''; position: absolute; background-color: var(--primary-color); box-shadow: 0 0 5px var(--primary-color), 0 0 10px var(--primary-color); }
    .cursor::before { width: 2px; height: 10px; }
    .cursor::after { width: 10px; height: 2px; }
    .trail { position: fixed; pointer-events: none; z-index: 9999; color: #00ff41; font-size: 1.2rem; text-shadow: 0 0 8px #00ff41; animation: fadeOut 0.8s forwards; transform: translate(-50%, -50%); }
    body.no-trail .trail { display: none; }
    @keyframes fadeOut { from { opacity: 1; transform: translate(-50%, -50%) scale(1); } to { opacity: 0; transform: translate(-50%, -50%) scale(0.5); } }
    .click-effect { width: 80px; height: 80px; border: 2px solid var(--accent-color); border-radius: 50%; position: fixed; pointer-events: none; transform: translate(-50%, -50%); z-index: 10001; opacity: 0; animation: click-animation 0.5s ease-out; }
    @keyframes click-animation { 0% { transform: translate(-50%, -50%) scale(0); opacity: 1; } 80% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; } 100% { transform: translate(-50%, -50%) scale(1.2); opacity: 0; } }
    .social-icon { color: var(--primary-color); transition: all 0.3s ease; filter: drop-shadow(0 0 5px var(--primary-color)); }
    .social-icon:hover { color: var(--accent-color); transform: scale(1.1) rotate(5deg); filter: drop-shadow(0 0 15px var(--accent-color)); }
    
    /* Tutorial Styles */
    #tutorial-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 10000;
    }
    .tutorial-highlight {
        position: relative;
        z-index: 10001;
        box-shadow: 0 0 25px var(--primary-color), 0 0 15px var(--primary-color) inset;
        border-radius: 0.375rem; /* 6px */
    }
    #tutorial-step-container {
        position: fixed;
        z-index: 10002;
        max-width: 350px;
        transition: all 0.3s ease-in-out;
    }

    @media (max-width: 768px) { .cursor, .trail { display: none; } body, a, button, .copy-btn, .hacker-btn { cursor: auto; } }
  </style>
</head>
<body class="bg-gray-900 text-gray-200">

  <div class="cursor"></div>
  
  <div id="tutorial-overlay" class="hidden"></div>
  <div id="tutorial-step-container" class="hidden"></div>

  <div id="disclaimer-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-[9998] backdrop-blur-sm">
      <div class="hacker-container rounded-lg p-6 w-full max-w-lg m-4 text-center">
          <div>
              <h2 class="category-title text-3xl mb-4">[ WARNING ]</h2>
              <p class="text-gray-300 mb-6">
                  This tool is intended for educational and authorized security testing purposes only.
                  Any actions and activities performed using NexusRecon are the sole responsibility of the user.
                  The creators of this tool are not responsible for any misuse or damage caused by this program.
                  Use responsibly and with proper authorization.
              </p>
              <button id="agree-btn" class="w-full hacker-btn font-bold py-3 px-6 rounded-md">
                  [ I Understand & Agree ]
              </button>
          </div>
      </div>
  </div>

  <div class="container mx-auto p-4 sm:px-6 md:px-8 py-8">
    <header class="text-center mb-10">
      <h1 class="glitch text-4xl sm:text-5xl" data-text="NexusRecon">NexusRecon</h1>
      <p class="text-cyan-400 mt-4 text-base sm:text-lg">[ Advanced Reconnaissance Framework ]</p>
    </header>

    <main id="main-content">
      <!-- Target Input Section -->
      <div id="tutorial-step-1" class="mb-12 hacker-container p-6 rounded-lg">
        <div> <!-- This extra div is for the corner brackets -->
            <label class="block text-lg font-medium text-cyan-400 mb-2">// Select Recon Mode & Enter Target:</label>
            <div id="tutorial-step-2" class="flex flex-wrap gap-2 mb-4">
                <button class="tab-btn active py-2 px-4 rounded-md" data-mode="website">Website Recon</button>
                <button class="tab-btn py-2 px-4 rounded-md" data-mode="user">User Recon</button>
            </div>
            <div class="flex flex-col sm:flex-row gap-4">
              <input type="text" id="target-input" placeholder="Enter Domain or Company..." class="w-full px-4 py-3 hacker-input rounded-md" />
              <button id="clear-target" class="bg-red-600/50 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-md hacker-btn border-red-500">Clear</button>
            </div>
            <p id="error-message" class="text-red-400 mt-2 hidden"></p>
        </div>
      </div>

      <!-- Recon Modules -->
      <div class="space-y-10">

        <!-- Floating Action Buttons -->
        <div id="tutorial-step-5" class="fixed left-1 bottom-1 flex flex-col space-y-4">
            <button id="notes-toggle" class="floating-btn hacker-btn p-4 rounded-full" title="Toggle Notes Panel">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            </button>
            <button id="settings-toggle" class="floating-btn hacker-btn p-4 rounded-full" title="Toggle Settings Panel">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
            <button id="history-toggle" class="floating-btn hacker-btn p-4 rounded-full" title="Toggle Session History Panel">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>
        </div>
        
        <!-- Investigation Workspace Panel -->
        <div id="notes-panel" class="side-panel hacker-container p-6 rounded-lg overflow-y-auto">
            <button id="notes-close" class="hacker-btn rounded-full p-2 float-right sticky top-4 z-10 border-red-500 text-red-400 hover:bg-red-500 hover:text-black">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="space-y-8 clear-both">
                <!-- Investigation Workspace -->
                <div data-recon-type="all">
                    <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Investigation Workspace</h2>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <p class="text-gray-400 text-sm">// Notes are saved per-target...</p>
                                <button id="clear-workspace" class="hacker-btn text-xs p-2 border-red-500 text-red-400">[ Clear Workspace ]</button>
                            </div>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label for="workspace-subdomains" class="block text-cyan-400 mb-2">Subdomains:</label>
                                    <textarea id="workspace-subdomains" rows="3" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="example.com&#10;dev.example.com"></textarea>
                                </div>
                                <div>
                                    <label for="workspace-emails" class="block text-cyan-400 mb-2">Email Addresses:</label>
                                    <textarea id="workspace-emails" rows="3" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="admin@example.com"></textarea>
                                </div>
                                <div>
                                    <label for="workspace-ips" class="block text-cyan-400 mb-2">IP Addresses:</label>
                                    <textarea id="workspace-ips" rows="3" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="192.168.1.1"></textarea>
                                </div>
                                <div>
                                    <label for="workspace-urls" class="block text-cyan-400 mb-2">Interesting URLs:</label>
                                    <textarea id="workspace-urls" rows="3" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="example.com/login.php"></textarea>
                                </div>
                                <div>
                                    <label for="workspace-notes" class="block text-cyan-400 mb-2">General Notes:</label>
                                    <textarea id="workspace-notes" rows="4" class="workspace-textarea w-full p-2 text-sm rounded-md" placeholder="Found potential vulnerability in..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Session History Panel -->
        <div id="history-panel" class="side-panel hacker-container p-6 rounded-lg overflow-y-auto">
            <button id="history-close" class="hacker-btn rounded-full p-2 float-right sticky top-4 z-10 border-red-500 text-red-400 hover:bg-red-500 hover:text-black">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="space-y-8 clear-both">
                <div data-recon-type="all">
                    <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Session History</h2>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between items-center">
                                <p class="text-gray-400 text-sm">// Your activity is saved locally...</p>
                                <button id="clear-history" class="hacker-btn text-xs p-2 border-red-500 text-red-400">[ Clear History ]</button>
                            </div>
                            <div id="history-container" class="mt-4 max-h-96 overflow-y-auto space-y-3 pr-2">
                                <!-- History entries will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="side-panel hacker-container p-6 rounded-lg overflow-y-auto">
            <button id="settings-close" class="hacker-btn rounded-full p-2 float-right sticky top-4 z-10 border-red-500 text-red-400 hover:bg-red-500 hover:text-black">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="space-y-8 clear-both">
                <div data-recon-type="all">
                    <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Settings</h2>
                    <div class="space-y-4">
                        <div>
                            <p class="text-gray-400 text-sm mb-2">// Theme</p>
                            <div class="flex gap-2">
                                <button id="theme-cyberpunk" class="hacker-btn text-sm p-2 w-full">[ Cyberpunk ]</button>
                                <button id="theme-matrix" class="hacker-btn text-sm p-2 w-full">[ Matrix ]</button>
                            </div>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm mb-2">// Animations</p>
                            <div class="space-y-2">
                                <label class="flex items-center justify-between"><span>Logo Animation</span><input type="checkbox" id="toggle-logo-animation" class="h-5 w-5"></label>
                                <label class="flex items-center justify-between"><span>Grid Animation</span><input type="checkbox" id="toggle-grid-animation" class="h-5 w-5"></label>
                                <label class="flex items-center justify-between"><span>Cursor Trail</span><input type="checkbox" id="toggle-cursor-trail" class="h-5 w-5"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Automated Recon Workflows -->
        <div data-recon-type="website">
            <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Automated Recon Workflows</h2>
            <div class="space-y-10">
                <!-- Automated Target Profiler -->
                <div class="hacker-container p-6 rounded-lg space-y-4">
                    <div>
                        <h3 class="subcategory-title text-xl font-semibold mb-2">// Automated Target Profiler</h3>
                        <p class="text-gray-400 mb-4">// Run a sequence of essential dorks against the target...</p>
                        <button id="initiate-profile" class="w-full hacker-btn font-bold py-3 px-6 rounded-md">
                            [ Initiate Target Profile ]
                        </button>
                        <div id="profiler-results-container" class="hidden mt-4 pt-4 border-t border-fuchsia-500/50">
                            <p id="profiler-status" class="text-cyan-400 mb-4"></p>
                            <div id="profiler-results-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
                <!-- Target Tech-Stack Identifier -->
                <div class="hacker-container p-6 rounded-lg space-y-4">
                    <div>
                        <h3 class="subcategory-title text-xl font-semibold mb-2">// Target Tech-Stack Identifier</h3>
                        <p class="text-gray-400 mb-4">// Run dorks to identify the target's technology stack...</p>
                        <button id="identify-tech" class="w-full hacker-btn font-bold py-3 px-6 rounded-md">
                            [ Identify Tech Stack ]
                        </button>
                        <div id="tech-results-container" class="hidden mt-4 pt-4 border-t border-fuchsia-500/50">
                            <p id="tech-status" class="text-cyan-400 mb-4"></p>
                            <div id="tech-results-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manual Investigation Modules -->
        <div>
            <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Manual Investigation Modules</h2>
            <div class="space-y-10">
                <!-- External Reconnaissance -->
                <div id="tutorial-step-3" class="hacker-container p-6 rounded-lg space-y-6">
                    <div>
                        <h3 class="subcategory-title text-xl font-semibold mb-4">// OSINT & External Tools</h3>
                        <div class="dork-grid">
                            <button id="external-virustotal" class="hacker-btn p-3" data-recon-type="website" title="Analyze the target domain for malware and reputation.">[ VirusTotal ]</button>
                            <button id="external-censys" class="hacker-btn p-3" data-recon-type="website" title="Find hosts and networks belonging to the target.">[ Censys ]</button>
                            <button id="external-shodan" class="hacker-btn p-3" data-recon-type="website" title="Search for internet-connected devices and services.">[ Shodan ]</button>
                            <button id="external-netlas" class="hacker-btn p-3" data-recon-type="website" title="Explore internet intelligence data.">[ Netlas.io ]</button>
                            <button id="external-fofa" class="hacker-btn p-3" data-recon-type="website" title="Cyberspace asset search engine.">[ FOFA.so ]</button>
                            <button id="external-zoomeye" class="hacker-btn p-3" data-recon-type="website" title="Another cyberspace asset search engine.">[ ZoomEye ]</button>
                            <button id="external-securityheaders" class="hacker-btn p-3" data-recon-type="website" title="Check security-related HTTP headers.">[ SecurityHeaders.io ]</button>
                            <button id="external-crtsh" class="hacker-btn p-3" data-recon-type="website" title="Search for SSL/TLS certificates.">[ crt.sh ]</button>
                            <button id="external-dnsdumpster" class="hacker-btn p-3" data-recon-type="website" title="Find DNS records and subdomains.">[ DNSdumpster ]</button>
                            <button id="external-viewdns" class="hacker-btn p-3" data-recon-type="website" title="A suite of DNS and network tools.">[ ViewDNS.info ]</button>
                            <button id="external-whois" class="hacker-btn p-3" data-recon-type="website" title="Find domain registration information.">[ who.is ]</button>
                            <button id="external-rapiddns" class="hacker-btn p-3" data-recon-type="website" title="DNS query tool for subdomains and records.">[ RapidDNS ]</button>
                            <button id="external-github" class="hacker-btn p-3" data-recon-type="all" title="Search for code and secrets on GitHub.">[ GitHub ]</button>
                            <button id="external-pastebin" class="hacker-btn p-3" data-recon-type="all" title="Search for leaks on Pastebin and similar sites.">[ Pastebin ]</button>
                            <button id="external-leakix" class="hacker-btn p-3" data-recon-type="website" title="Search for publicly indexed leaks.">[ LeakIX ]</button>
                            <button id="external-grepapp" class="hacker-btn p-3" data-recon-type="all" title="Search across git repositories.">[ Grep.app ]</button>
                            <button id="external-searchcode" class="hacker-btn p-3" data-recon-type="all" title="Search for code across multiple sources.">[ Searchcode ]</button>
                            <button id="external-grayhat" class="hacker-btn p-3" data-recon-type="website" title="Search public S3 buckets.">[ Grayhat Warfare ]</button>
                            <button id="external-dehashed" class="hacker-btn p-3" data-recon-type="website" title="Search for credentials in data breaches.">[ Dehashed ]</button>
                            <button id="external-haveibeenpwned" class="hacker-btn p-3" data-recon-type="user" title="Check if an email has been in a data breach.">[ HaveIBeenPwned ]</button>
                            <button id="external-wayback" class="hacker-btn p-3" data-recon-type="website" title="Find archived versions of web pages.">[ Waybackurls ]</button>
                            <button id="external-urlscan" class="hacker-btn p-3" data-recon-type="website" title="Scan and analyze URLs.">[ urlscan.io ]</button>
                            <button id="external-builtwith" class="hacker-btn p-3" data-recon-type="website" title="Identify the technology stack of a website.">[ BuiltWith ]</button>
                            <button id="external-publicwww" class="hacker-btn p-3" data-recon-type="website" title="Find websites with specific code snippets.">[ PublicWWW ]</button>
                            <button id="external-hunter" class="hacker-btn p-3" data-recon-type="website" title="Find email addresses associated with a domain.">[ Hunter.io ]</button>
                            <button id="external-emailrep" class="hacker-btn p-3" data-recon-type="user" title="Check the reputation of an email address.">[ EmailRep.io ]</button>
                            <button id="external-linkedin" class="hacker-btn p-3" data-recon-type="all" title="Search for employees and company info.">[ LinkedIn Search ]</button>
                            <button id="external-crunchbase" class="hacker-btn p-3" data-recon-type="all" title="Find business information about companies.">[ Crunchbase ]</button>
                            <button id="external-greynoise" class="hacker-btn p-3" data-recon-type="website" title="Analyze internet-wide scan traffic.">[ GreyNoise ]</button>
                            <button id="external-whatsmynameweb" class="hacker-btn p-3" data-recon-type="user" title="Find usernames across many sites.">[ WhatsMyName ]</button>
                            <button id="external-truecaller" class="hacker-btn p-3" data-recon-type="user" title="Identify phone numbers.">[ Truecaller ]</button>
                            <button id="external-syncme" class="hacker-btn p-3" data-recon-type="user" title="Another phone number identification service.">[ Sync.me ]</button>
                            <button id="external-yandex" class="hacker-btn p-3" data-recon-type="all" title="Search engine with powerful image search.">[ Yandex ]</button>
                            <button id="external-ahmia" class="hacker-btn p-3" data-recon-type="all" title="Search engine for Tor hidden services.">[ Ahmia.fi (TOR) ]</button>
                        </div>
                    </div>
                </div>

                <!-- Visual Reconnaissance -->
                <div data-recon-type="website">
                    <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Visual Recon (Favicon Pivoting)</h2>
                    <div class="hacker-container p-6 rounded-lg space-y-4">
                        <div>
                            <p class="text-gray-400">// Find related infrastructure by searching for the target's favicon hash on Shodan...</p>
                            <button id="favicon-pivot" class="w-full hacker-btn font-bold py-3 px-6 rounded-md mt-4">
                                [ Find by Favicon Hash (Shodan) ]
                            </button>
                            <p class="text-xs text-gray-500 mt-2">// Note: This is a conceptual search. For accurate results, calculate the MurmurHash3 of the favicon and search Shodan for `http.favicon.hash:&lt;hash&gt;`.</p>
                        </div>
                    </div>
                </div>

                <!-- Google Dorking Toggle -->
                <div id="tutorial-step-4" class="hacker-container p-6 rounded-lg" data-recon-type="website">
                    <div>
                        <button id="toggle-dorking-modules" class="w-full hacker-btn p-3 font-bold text-xl">
                            [ Show Google Dorking Modules ]
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Collapsible Dorking Modules Container -->
        <div id="dorking-modules-container" class="hidden space-y-10" data-recon-type="website">
            
            <!-- Basic Recon -->
            <div>
              <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Basic Recon Dorks</h2>
              <div class="dork-grid">
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN' title="Find all pages indexed by Google for the target domain."><span class="dork-text">All Indexed Pages</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:*.TARGET_DOMAIN -site:www.TARGET_DOMAIN' title="Discover subdomains of the target domain."><span class="dork-text">Subdomains</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN inurl:login | inurl:signin | intitle:"Login" | intitle:"Sign In"' title="Find potential login portals."><span class="dork-text">Login Pages</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"index of"' title="Look for open directories that might expose files."><span class="dork-text">Open Directories</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
              </div>
            </div>

            <!-- Credentials & Sensitive Keys -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Credentials & Sensitive Keys</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "AWS_ACCESS_KEY_ID" "AKIA"' title="Search for exposed AWS access keys."><span class="dork-text">AWS Keys</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "api_key" | "apikey"' title="Find API keys that may have been left in public code."><span class="dork-text">Exposed API Keys</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN filetype:env "DB_PASSWORD"' title="Look for public .env files containing database passwords."><span class="dork-text">Public .env Files</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "password" filetype:log' title="Search for passwords in log files."><span class="dork-text">Passwords in Logs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"index of" ".ssh"' title="Find exposed SSH directories."><span class="dork-text">Exposed SSH Dirs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN inurl:id_rsa -github' title="Search for exposed SSH private keys."><span class="dork-text">Exposed SSH Keys</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>
            
            <!-- Backup Files -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Backups & Database Dumps</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN ext:sql | ext:db | ext:mdb | ext:backup | ext:bak | ext:dump' title="Find database backups and dumps."><span class="dork-text">DB Backups & Dumps</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "Index of /" "backup"' title="Look for backup directories."><span class="dork-text">Backup Directories</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN filetype:zip | filetype:tar "backup"' title="Find compressed backup files."><span class="dork-text">Compressed Backups</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>

            <!-- Sensitive Files -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Sensitive Documents</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "Internal use only" | "confidential"' title="Search for documents marked as internal or confidential."><span class="dork-text">Internal / Confidential</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN ext:pdf | ext:doc | ext:docx "invoice" "paid"' title="Find receipts and invoices."><span class="dork-text">Receipts & Invoices</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN ext:xls | ext:xlsx "salary"' title="Look for spreadsheets containing salary information."><span class="dork-text">Salary Spreadsheets</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>

            <!-- Vulnerable Files & Server Info -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Vulnerable Files & Server Info</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"apache tomcat" "administration"' title="Find Apache Tomcat administration panels."><span class="dork-text">Tomcat Admin</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN intitle:"index of" "ws_ftp.log"' title="Look for WS_FTP log files."><span class="dork-text">WS_FTP Logs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN filetype:log "inurl:wp-content"' title="Find WordPress debug logs."><span class="dork-text">WordPress Debug Logs</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>

            <!-- Test Endpoints & Errors -->
            <div>
                <h2 class="category-title text-2xl font-semibold border-b-2 border-fuchsia-500/50 pb-2 mb-4">>> Test Endpoints & Errors</h2>
                <div class="dork-grid">
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:*.dev.TARGET_DOMAIN | site:*.stage.TARGET_DOMAIN | site:*.test.TARGET_DOMAIN' title="Find development, staging, and test subdomains."><span class="dork-text">Dev/Staging Subdomains</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN "PHP Fatal error" | "PHP Warning"' title="Search for PHP errors."><span class="dork-text">PHP Errors</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='intext:"sql syntax near" | intext:"syntax error has occurred" site:TARGET_DOMAIN' title="Find SQL syntax errors."><span class="dork-text">SQL Errors</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                    <div class="dork-item p-2 flex items-center justify-between"><button class="w-full text-left p-2" data-dork='site:TARGET_DOMAIN inurl:/proc/self/cwd' title="Look for potential Local File Inclusion (LFI) or path traversal vulnerabilities."><span class="dork-text">LFI/Path Traversal</span></button><button class="copy-btn hacker-btn px-3 py-1 rounded-md text-sm">Copy</button></div>
                </div>
            </div>
        </div>

      </div>
    </main>

    <footer class="text-center mt-12 text-gray-500">
        <p>// Happy Hacking! Use responsibly and with authorization. //</p>
        <p class="mt-4 text-sm italic">Made with <span class="text-red-500">&hearts;</span> by 4n1_1p4m</p>
        <div class="flex justify-center items-center space-x-6 mt-4">
            <a href="https://www.linkedin.com/in/anupamjaiswall" target="_blank" rel="noopener noreferrer" class="social-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
            </a>
            <a href="https://github.com/anupamjaiswall" target="_blank" rel="noopener noreferrer" class="social-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
            </a>
            <a href="https://www.instagram.com/anupamjaiswall" target="_blank" rel="noopener noreferrer" class="social-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
            </a>
            <a href="https://www.buymeacoffee.com/anupamjaiswall" target="_blank" rel="noopener noreferrer" class="social-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>
            </a>
        </div>
    </footer>
  </div>
  
  <!-- Live2D Widget Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- Element Selectors ---
      const body = document.body;
      const mainContainer = document.querySelector('.container');
      const disclaimerModal = document.getElementById('disclaimer-modal');
      const agreeBtn = document.getElementById('agree-btn');
      const mainContent = document.getElementById('main-content');
      const targetInput = document.getElementById('target-input');
      const errorMessage = document.getElementById('error-message');
      
      const reconModeTabs = document.querySelectorAll('#tutorial-step-2 .tab-btn');
      
      const profilerResultsContainer = document.getElementById('profiler-results-container');
      const profilerStatus = document.getElementById('profiler-status');
      const profilerResultsList = document.getElementById('profiler-results-list');
      
      const techResultsContainer = document.getElementById('tech-results-container');
      const techStatus = document.getElementById('tech-status');
      const techResultsList = document.getElementById('tech-results-list');

      const toggleDorkingBtn = document.getElementById('toggle-dorking-modules');
      const dorkingContainer = document.getElementById('dorking-modules-container');

      const historyContainer = document.getElementById('history-container');
      
      const workspaceSubdomains = document.getElementById('workspace-subdomains');
      const workspaceEmails = document.getElementById('workspace-emails');
      const workspaceIps = document.getElementById('workspace-ips');
      const workspaceUrls = document.getElementById('workspace-urls');
      const workspaceNotes = document.getElementById('workspace-notes');
      const workspaceElements = [workspaceSubdomains, workspaceEmails, workspaceIps, workspaceUrls, workspaceNotes];

      // Panel Selectors
      const notesToggle = document.getElementById('notes-toggle');
      const settingsToggle = document.getElementById('settings-toggle');
      const historyToggle = document.getElementById('history-toggle');
      const notesPanel = document.getElementById('notes-panel');
      const settingsPanel = document.getElementById('settings-panel');
      const historyPanel = document.getElementById('history-panel');
      const notesClose = document.getElementById('notes-close');
      const settingsClose = document.getElementById('settings-close');
      const historyClose = document.getElementById('history-close');
      const allPanels = [notesPanel, settingsPanel, historyPanel];

      // Settings Controls Selectors
      const themeCyberpunkBtn = document.getElementById('theme-cyberpunk');
      const themeMatrixBtn = document.getElementById('theme-matrix');
      const toggleLogoAnim = document.getElementById('toggle-logo-animation');
      const toggleGridAnim = document.getElementById('toggle-grid-animation');
      const toggleCursorTrail = document.getElementById('toggle-cursor-trail');
      
      // Tutorial Selectors
      const tutorialOverlay = document.getElementById('tutorial-overlay');
      const tutorialStepContainer = document.getElementById('tutorial-step-container');

      let history = JSON.parse(localStorage.getItem('nexusReconHistory')) || [];

      // --- External Tools Data ---
      const externalButtonsData = {
        'external-virustotal': { url: 'https://www.virustotal.com/gui/domain/TARGET_QUERY', name: 'VirusTotal' },
        'external-censys': { url: 'https://search.censys.io/search?resource=hosts&q=TARGET_QUERY', name: 'Censys' },
        'external-shodan': { url: 'https://www.shodan.io/search?query=TARGET_QUERY', name: 'Shodan' },
        'external-netlas': { url: 'https://app.netlas.io/host/TARGET_QUERY/', name: 'Netlas.io' },
        'external-fofa': { url: 'https://en.fofa.info/result?qbase64=FOFA_B64_QUERY', name: 'FOFA' },
        'external-zoomeye': { url: 'https://www.zoomeye.org/searchResult?q=TARGET_QUERY', name: 'ZoomEye' },
        'external-securityheaders': { url: 'https://securityheaders.com/?q=TARGET_QUERY&followRedirects=on&hide=on', name: 'SecurityHeaders.io' },
        'external-crtsh': { url: 'https://crt.sh/?q=TARGET_QUERY', name: 'crt.sh' },
        'external-dnsdumpster': { url: 'https://dnsdumpster.com/', name: 'DNSdumpster' },
        'external-viewdns': { url: 'https://viewdns.info/whois/?domain=TARGET_QUERY', name: 'ViewDNS.info' },
        'external-whois': { url: 'https://who.is/whois/TARGET_QUERY', name: 'who.is' },
        'external-rapiddns': { url: 'https://rapiddns.io/subdomain/TARGET_QUERY', name: 'RapidDNS' },
        'external-github': { url: 'https://github.com/search?q="TARGET_QUERY"&type=code', name: 'GitHub Search' },
        'external-pastebin': { url: 'https://www.google.com/search?q=site:pastebin.com "TARGET_QUERY"', name: 'Pastebin Search' },
        'external-leakix': { url: 'https://leakix.net/search?q=TARGET_QUERY', name: 'LeakIX' },
        'external-grepapp': { url: 'https://grep.app/?q=TARGET_QUERY', name: 'Grep.app' },
        'external-searchcode': { url: 'https://searchcode.com/?q=TARGET_QUERY', name: 'Searchcode' },
        'external-grayhat': { url: 'https://buckets.grayhatwarfare.com/files?keywords=TARGET_QUERY', name: 'Grayhat Warfare' },
        'external-dehashed': { url: 'https://www.dehashed.com/search?query=domain%3ATARGET_QUERY', name: 'Dehashed' },
        'external-haveibeenpwned': { url: 'https://haveibeenpwned.com/', name: 'HaveIBeenPwned' },
        'external-wayback': { url: 'https://web.archive.org/web/*/TARGET_QUERY', name: 'Waybackurls' },
        'external-urlscan': { url: 'https://urlscan.io/search/#TARGET_QUERY', name: 'urlscan.io' },
        'external-builtwith': { url: 'https://builtwith.com/?TARGET_QUERY', name: 'BuiltWith' },
        'external-publicwww': { url: 'https://publicwww.com/websites/%22TARGET_QUERY%22/', name: 'PublicWWW' },
        'external-hunter': { url: 'https://hunter.io/search?domain=TARGET_QUERY', name: 'Hunter.io' },
        'external-emailrep': { url: 'https://emailrep.io/', name: 'EmailRep.io' },
        'external-linkedin': { url: 'https://www.google.com/search?q=site:linkedin.com/in "TARGET_QUERY"', name: 'LinkedIn Search' },
        'external-crunchbase': { url: 'https://www.crunchbase.com/textsearch?q=TARGET_QUERY', name: 'Crunchbase' },
        'external-greynoise': { url: 'https://viz.greynoise.io/query?gnql=TARGET_QUERY', name: 'GreyNoise' },
        'external-whatsmynameweb': { url: 'https://whatsmyname.app/?q=TARGET_QUERY', name: 'WhatsMyName' },
        'external-truecaller': { url: 'https://www.truecaller.com/search/in/TARGET_QUERY', name: 'Truecaller' },
        'external-syncme': { url: 'https://sync.me/search/?number=TARGET_QUERY', name: 'Sync.me' },
        'external-yandex': { url: 'https://yandex.com/search/?text=TARGET_QUERY', name: 'Yandex' },
        'external-ahmia': { url: 'https://ahmia.fi/search/?q=TARGET_QUERY', name: 'Ahmia.fi' }
      };

      // --- Settings Management ---
      const defaultSettings = {
          theme: 'cyberpunk',
          logoAnim: true,
          gridAnim: true,
          cursorTrail: true
      };

      let currentSettings = JSON.parse(localStorage.getItem('nexusReconSettings')) || defaultSettings;

      const saveSettings = () => {
          localStorage.setItem('nexusReconSettings', JSON.stringify(currentSettings));
      };

      const applySettings = () => {
          // Theme
          body.classList.remove('theme-matrix');
          if (currentSettings.theme === 'matrix') {
              body.classList.add('theme-matrix');
          }
          // Animations
          body.classList.toggle('no-logo-animation', !currentSettings.logoAnim);
          body.classList.toggle('no-grid-animation', !currentSettings.gridAnim);
          body.classList.toggle('no-trail', !currentSettings.cursorTrail);
          // Update checkboxes
          toggleLogoAnim.checked = currentSettings.logoAnim;
          toggleGridAnim.checked = currentSettings.gridAnim;
          toggleCursorTrail.checked = currentSettings.cursorTrail;
      };

      // --- Core Functions ---
      const getActiveTarget = () => targetInput.value.trim();

      const handleMissingTarget = () => {
          errorMessage.textContent = 'ERROR: Target required for this action.';
          errorMessage.classList.remove('hidden');
          targetInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
          targetInput.classList.add('shake-error');
          setTimeout(() => targetInput.classList.remove('shake-error'), 820);
      };

      const typeEffect = (element, text, speed = 50, callback) => {
        element.textContent = "";
        let i = 0;
        const timer = setInterval(() => {
            if (i < text.length) {
                element.textContent += text.charAt(i);
                i++;
            } else {
                clearInterval(timer);
                if (callback) callback();
            }
        }, speed);
      };

      // --- History Functions ---
      const addHistoryEntry = (action, target, note = '') => {
          const entry = { id: Date.now(), time: new Date().toLocaleTimeString(), action, target, note };
          history.unshift(entry);
          if (history.length > 50) history.pop();
          localStorage.setItem('nexusReconHistory', JSON.stringify(history));
          renderHistory();
      };
      
      const renderHistory = () => {
          if (!historyContainer) return;
          historyContainer.innerHTML = history.length === 0 
              ? '<p class="text-gray-500 italic">// No activity yet...</p>'
              : history.map(entry => `
                  <div class="bg-black/30 p-3 rounded-md border border-fuchsia-500/30">
                    <p class="text-sm"><span class="text-gray-500">[${entry.time}]</span> Used <span class="text-fuchsia-400">${entry.action}</span> on <span class="text-cyan-400">${entry.target}</span></p>
                    <textarea class="note-input w-full mt-2 p-2 text-xs rounded-md bg-black/50 border-fuchsia-500/50" data-id="${entry.id}" placeholder="// Add notes...">${entry.note}</textarea>
                  </div>
                `).join('');
      };

      // --- Workspace Functions ---
      const saveWorkspaceData = () => {
          const target = getActiveTarget();
          if (!target) return;
          const data = {
              subdomains: workspaceSubdomains.value,
              emails: workspaceEmails.value,
              ips: workspaceIps.value,
              urls: workspaceUrls.value,
              notes: workspaceNotes.value,
          };
          localStorage.setItem(`nexusWorkspace_${target}`, JSON.stringify(data));
      };

      const loadWorkspaceData = () => {
          const target = getActiveTarget();
          const data = JSON.parse(localStorage.getItem(`nexusWorkspace_${target}`)) || {};
          workspaceSubdomains.value = data.subdomains || '';
          workspaceEmails.value = data.emails || '';
          workspaceIps.value = data.ips || '';
          workspaceUrls.value = data.urls || '';
          workspaceNotes.value = data.notes || '';
      };

      // --- Panel Management ---
      const togglePanel = (panelToToggle) => {
          const isOpen = panelToToggle.classList.contains('open');
          // Close all panels first
          allPanels.forEach(p => p.classList.remove('open'));
          // If the panel was closed, open it
          if (!isOpen) {
              panelToToggle.classList.add('open');
          }
      };

      // --- Recon Mode Switching ---
      const setReconMode = (mode) => {
          reconModeTabs.forEach(t => t.classList.toggle('active', t.dataset.mode === mode));
          targetInput.placeholder = mode === 'website' 
              ? 'Enter Domain or Company...' 
              : 'Enter Username, Email, or Phone...';

          document.querySelectorAll('[data-recon-type]').forEach(module => {
              const type = module.dataset.reconType;
              module.style.display = (type === 'all' || type === mode) ? '' : 'none';
          });
      };

      // --- Dork & Tool Execution ---
      const executeDork = (dorkTemplate, actionName) => {
        const target = getActiveTarget();
        if (!target) {
          handleMissingTarget();
          return;
        }
        errorMessage.classList.add('hidden');
        const finalDork = dorkTemplate.replace(/TARGET_DOMAIN/g, target);
        addHistoryEntry(actionName, target);
        window.open(`https://www.google.com/search?q=${encodeURIComponent(finalDork)}`, '_blank');
      };

      const copyDork = (dorkTemplate, copyBtn) => {
        const target = getActiveTarget();
        if (!target) {
          handleMissingTarget();
          return;
        }
        errorMessage.classList.add('hidden');
        const finalDork = dorkTemplate.replace(/TARGET_DOMAIN/g, target);
        
        navigator.clipboard.writeText(finalDork).then(() => {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Copied!';
          copyBtn.style.backgroundColor = '#ff00c1'; // Magenta feedback
          copyBtn.style.borderColor = '#ff00c1';
          setTimeout(() => {
              copyBtn.textContent = originalText;
              copyBtn.style.backgroundColor = '';
              copyBtn.style.borderColor = '';
          }, 1500);
        }).catch(err => {
          console.error('Failed to copy text: ', err);
          copyBtn.textContent = 'Error!';
          setTimeout(() => copyBtn.textContent = 'Copy', 1500);
        });
      };

      const openExternalTool = (urlTemplate, toolName) => {
        const target = getActiveTarget();
        if(!target) {
          handleMissingTarget();
          return;
        }
        addHistoryEntry(toolName, target);
        let finalUrl = urlTemplate;
        if (urlTemplate.includes('FOFA_B64_QUERY')) {
            const query = btoa(`domain="${target}"`);
            finalUrl = urlTemplate.replace('FOFA_B64_QUERY', query);
        } else {
            finalUrl = urlTemplate.replace(/TARGET_QUERY/g, encodeURIComponent(target));
        }
        window.open(finalUrl, '_blank');
      };
      
      // --- Tutorial Logic ---
      const tutorialSteps = [
        {
            element: '#tutorial-step-1',
            title: 'Step 1: The Target',
            content: 'This is the main input area. Enter your target domain, company name, or username here to begin your reconnaissance.'
        },
        {
            element: '#tutorial-step-2',
            title: 'Step 2: Recon Mode',
            content: 'Switch between "Website Recon" for domains and companies, or "User Recon" for usernames and emails. The available tools will adapt to your choice.'
        },
        {
            element: '#tutorial-step-3',
            title: 'Step 3: External Tools',
            content: 'This is your arsenal. It contains a curated list of powerful OSINT tools. Clicking any button will open that tool in a new tab with your target pre-filled.'
        },
        {
            element: '#tutorial-step-4',
            title: 'Step 4: Google Dorking',
            content: 'Click here to reveal a comprehensive library of Google Dorks, categorized for finding specific types of sensitive information.'
        },
        {
            element: '#tutorial-step-5',
            title: 'Step 5: Your Workspace',
            content: 'These floating buttons open your side panels for Settings, Session History, and your Investigation Notes. Your notes are saved locally per target.'
        },
        {
            title: 'Tutorial Complete!',
            content: 'You\'re all set. Remember to use this tool responsibly and with proper authorization. Happy hacking!'
        }
      ];

      let currentStepIndex = 0;
      let highlightedElement = null;
      let tutorialRepositionHandler = null; // To hold the scroll listener function

      function repositionTutorialPopover() {
        if (!highlightedElement || tutorialStepContainer.classList.contains('hidden')) {
            return;
        }
        const rect = highlightedElement.getBoundingClientRect();
        const popover = tutorialStepContainer;
        const popoverHeight = popover.offsetHeight;
        const popoverWidth = popover.offsetWidth;
        const currentStep = tutorialSteps[currentStepIndex];

        if (currentStep && currentStep.element === '#tutorial-step-5') {
            // Special positioning for the floating buttons in the bottom-left corner.
            popover.style.left = `${rect.right + 15}px`;
            popover.style.top = `${rect.bottom - popoverHeight}px`; // Align bottom of popover with bottom of element
        } else {
            // Default positioning logic for all other elements.
            const spaceBelow = window.innerHeight - rect.bottom;

            // Vertical positioning: If not enough space below, and there's space above, place it above.
            if (spaceBelow < (popoverHeight + 20) && rect.top > popoverHeight + 20) {
                popover.style.top = `${rect.top - popoverHeight - 10}px`;
            } else {
                // Default to below
                popover.style.top = `${rect.bottom + 10}px`;
            }

            // Horizontal positioning: Adjust if it overflows the right edge of the viewport.
            let leftPos = rect.left;
            if (leftPos + popoverWidth > window.innerWidth) {
                leftPos = window.innerWidth - popoverWidth - 20;
            }
            popover.style.left = `${Math.max(10, leftPos)}px`;
        }
      }

      function endTutorial() {
          tutorialOverlay.classList.add('hidden');
          tutorialStepContainer.classList.add('hidden');
          if (highlightedElement) {
              highlightedElement.classList.remove('tutorial-highlight');
          }
          if (tutorialRepositionHandler) {
            window.removeEventListener('scroll', tutorialRepositionHandler);
            tutorialRepositionHandler = null;
          }
          localStorage.setItem('nexusReconTutorialCompleted', 'true');
      }

      function showTutorialStep(index) {
          currentStepIndex = index; // Keep track of the current step index
          if (highlightedElement) {
              highlightedElement.classList.remove('tutorial-highlight');
              highlightedElement = null;
          }
          if (tutorialRepositionHandler) {
            window.removeEventListener('scroll', tutorialRepositionHandler);
          }

          const step = tutorialSteps[index];
          if (!step) {
              endTutorial();
              return;
          }
          
          const isLastStep = index === tutorialSteps.length - 1;

          tutorialStepContainer.innerHTML = `
            <div class="hacker-container p-4 rounded-lg">
                <div>
                    <h3 class="category-title text-xl mb-2">${step.title}</h3>
                    <p class="text-sm text-gray-300 mb-4">${step.content}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">${index + 1} / ${tutorialSteps.length}</span>
                        <div>
                            <button id="tutorial-skip" class="hacker-btn text-xs p-2 border-red-500 text-red-400">Skip</button>
                            ${index > 0 ? `<button id="tutorial-prev" class="hacker-btn text-xs p-2 ml-2">[ Prev ]</button>` : ''}
                            <button id="tutorial-next" class="hacker-btn text-xs p-2 ml-2">${isLastStep ? '[ Finish ]' : '[ Next ]'}</button>
                        </div>
                    </div>
                </div>
            </div>
          `;

          if (step.element) {
              const targetElement = document.querySelector(step.element);
              if (targetElement) {
                  highlightedElement = targetElement;
                  highlightedElement.classList.add('tutorial-highlight');
                  
                  // --- FIX: Only scroll if the element is NOT the fixed floating buttons ---
                  if (step.element !== '#tutorial-step-5') {
                    highlightedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }
                  
                  tutorialRepositionHandler = repositionTutorialPopover;
                  window.addEventListener('scroll', tutorialRepositionHandler);

                  setTimeout(() => {
                      repositionTutorialPopover(); // Initial positioning after scroll
                  }, 300);
              }
          } else {
              // Center the last step
              tutorialStepContainer.style.top = '50%';
              tutorialStepContainer.style.left = '50%';
              tutorialStepContainer.style.transform = 'translate(-50%, -50%)';
          }

          document.getElementById('tutorial-next').addEventListener('click', () => showTutorialStep(index + 1));
          if (index > 0) {
            document.getElementById('tutorial-prev').addEventListener('click', () => showTutorialStep(index - 1));
          }
          document.getElementById('tutorial-skip').addEventListener('click', endTutorial);
      }

      function startTutorial() {
          if (localStorage.getItem('nexusReconTutorialCompleted')) {
              return;
          }
          tutorialOverlay.classList.remove('hidden');
          tutorialStepContainer.classList.remove('hidden');
          currentStepIndex = 0;
          showTutorialStep(currentStepIndex);
      }

      // --- EVENT DELEGATION ---
      document.body.addEventListener('click', (e) => {
          const target = e.target;
          const targetId = target.id;
          
          // Dork Items
          const dorkItem = target.closest('.dork-item');
          if (dorkItem) {
              const dorkButton = dorkItem.querySelector('button[data-dork]');
              const copyButton = dorkItem.querySelector('.copy-btn');
              if (target.closest('.copy-btn')) {
                  copyDork(dorkButton.dataset.dork, copyButton);
              } else {
                  executeDork(dorkButton.dataset.dork, dorkButton.textContent.trim());
              }
          }

          // External Tools
          if (target.closest('.dork-grid button[id^="external-"]')) {
              const toolData = externalButtonsData[target.id];
              if (toolData) {
                  openExternalTool(toolData.url, toolData.name);
              }
          }

          // Other buttons by ID
          switch(targetId) {
              case 'clear-target':
                  targetInput.value = '';
                  errorMessage.classList.add('hidden');
                  loadWorkspaceData();
                  break;
              case 'initiate-profile':
                  const profilerTarget = getActiveTarget();
                  if (!profilerTarget) { handleMissingTarget(); return; }
                  addHistoryEntry('Automated Profiler', profilerTarget);
                  profilerResultsContainer.classList.remove('hidden');
                  profilerResultsList.innerHTML = '';
                  profilerStatus.textContent = `>> Scanning [${profilerTarget}]... Stand by...`;
                  const profilerDorks = [
                      { name: 'Subdomain Scan', dork: 'site:*.TARGET_DOMAIN -site:www.TARGET_DOMAIN' },
                      { name: 'Login Portals', dork: 'site:TARGET_DOMAIN inurl:login | inurl:signin' },
                      { name: 'Config Files', dork: 'site:TARGET_DOMAIN ext:xml | ext:conf | ext:ini | ext:log' },
                      { name: 'Public Cloud Buckets', dork: 'site:s3.amazonaws.com "TARGET_DOMAIN"' },
                      { name: 'Exposed Docs', dork: 'site:TARGET_DOMAIN ext:pdf | ext:docx "confidential"' }
                  ];
                  setTimeout(() => {
                      typeEffect(profilerStatus, `>> Profile for [${profilerTarget}] complete:`, 30, () => {
                          profilerDorks.forEach((item, index) => {
                              setTimeout(() => {
                                  const finalDork = item.dork.replace(/TARGET_DOMAIN/g, profilerTarget);
                                  const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(finalDork)}`;
                                  profilerResultsList.innerHTML += `<div class="flex justify-between items-center"><span>- ${item.name}.......</span><a href="${searchUrl}" target="_blank" class="hacker-btn text-sm px-3 py-1 rounded-md">[ View Results ]</a></div>`;
                              }, index * 100);
                          });
                      });
                  }, 1000);
                  break;
              case 'identify-tech':
                  const techTarget = getActiveTarget();
                  if (!techTarget) { handleMissingTarget(); return; }
                  addHistoryEntry('Tech-Stack Identifier', techTarget);
                  techResultsContainer.classList.remove('hidden');
                  techResultsList.innerHTML = '';
                  techStatus.textContent = `>> Identifying tech for [${techTarget}]...`;
                  const techDorks = [
                      { name: 'WordPress', dork: 'site:TARGET_DOMAIN inurl:wp-content | inurl:wp-admin' },
                      { name: 'Joomla', dork: 'site:TARGET_DOMAIN intext:"Powered by Joomla"' },
                      { name: 'Drupal', dork: 'site:TARGET_DOMAIN intext:"Powered by Drupal"' },
                      { name: 'Shopify', dork: 'site:TARGET_DOMAIN inurl:myshopify.com' },
                      { name: 'Apache Struts', dork: 'site:TARGET_DOMAIN filetype:action | filetype:do' },
                      { name: 'Adobe AEM', dork: 'site:TARGET_DOMAIN inurl:/content/dam' }
                  ];
                  setTimeout(() => {
                      typeEffect(techStatus, `>> Tech stack scan for [${techTarget}] complete:`, 30, () => {
                          techDorks.forEach((tech, index) => {
                              setTimeout(() => {
                                  const finalDork = tech.dork.replace(/TARGET_DOMAIN/g, techTarget);
                                  const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(finalDork)}`;
                                  techResultsList.innerHTML += `<div class="flex justify-between items-center"><span>- ${tech.name}.......</span><a href="${searchUrl}" target="_blank" class="hacker-btn text-sm px-3 py-1 rounded-md">[ Check ]</a></div>`;
                              }, index * 100);
                          });
                      });
                  }, 1000);
                  break;
              case 'favicon-pivot':
                  openExternalTool('https://www.shodan.io/search?query=http.html:"TARGET_QUERY"', 'Favicon Pivot');
                  break;
              case 'toggle-dorking-modules':
                  const isHidden = dorkingContainer.classList.toggle('hidden');
                  target.textContent = isHidden ? '[ Show Google Dorking Modules ]' : '[ Hide Google Dorking Modules ]';
                  if(!isHidden) setTimeout(() => dorkingContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
                  break;
              case 'clear-workspace':
                  const currentTarget = getActiveTarget();
                  if (currentTarget) {
                      localStorage.removeItem(`nexusWorkspace_${currentTarget}`);
                      loadWorkspaceData();
                  }
                  break;
              case 'clear-history':
                  history = [];
                  localStorage.removeItem('nexusReconHistory');
                  renderHistory();
                  break;
          }
      });

      // --- Individual Listeners for Non-Delegated Actions ---
      
      // Panel Toggles
      notesToggle.addEventListener('click', () => togglePanel(notesPanel));
      settingsToggle.addEventListener('click', () => togglePanel(settingsPanel));
      historyToggle.addEventListener('click', () => togglePanel(historyPanel));
      notesClose.addEventListener('click', () => notesPanel.classList.remove('open'));
      settingsClose.addEventListener('click', () => settingsPanel.classList.remove('open'));
      historyClose.addEventListener('click', () => historyPanel.classList.remove('open'));


      // Settings Controls
      themeCyberpunkBtn.addEventListener('click', () => {
          currentSettings.theme = 'cyberpunk';
          saveSettings();
          applySettings();
      });
      themeMatrixBtn.addEventListener('click', () => {
          currentSettings.theme = 'matrix';
          saveSettings();
          applySettings();
      });
      toggleLogoAnim.addEventListener('change', (e) => {
          currentSettings.logoAnim = e.target.checked;
          saveSettings();
          applySettings();
      });
      toggleGridAnim.addEventListener('change', (e) => {
          currentSettings.gridAnim = e.target.checked;
          saveSettings();
          applySettings();
      });
      toggleCursorTrail.addEventListener('change', (e) => {
          currentSettings.cursorTrail = e.target.checked;
          saveSettings();
          applySettings();
      });

      // Recon Mode Tabs
      reconModeTabs.forEach(tab => {
          tab.addEventListener('click', () => {
              setReconMode(tab.dataset.mode);
              loadWorkspaceData();
          });
      });

      // Target Input
      targetInput.addEventListener('change', loadWorkspaceData);

      // Workspace & History textareas
      workspaceElements.forEach(el => el.addEventListener('blur', saveWorkspaceData));
      historyContainer.addEventListener('change', (e) => {
          if (e.target.classList.contains('note-input')) {
              const entry = history.find(item => item.id === Number(e.target.dataset.id));
              if (entry) {
                  entry.note = e.target.value;
                  localStorage.setItem('nexusReconHistory', JSON.stringify(history));
              }
          }
      });

      // --- Initial Page Load ---
      mainContainer.classList.add('content-hidden');
      agreeBtn.addEventListener('click', () => {
          disclaimerModal.style.display = 'none';
          mainContainer.classList.remove('content-hidden');
          
          // Start tutorial on first visit after agreeing
          setTimeout(startTutorial, 500);

          // Initialize Live2D Widget AFTER user agrees
          try {
            L2Dwidget.init({
                "model": { "jsonPath": "https://cdn.jsdelivr.net/npm/live2d-widget-model-tororo@1.0.5/assets/tororo.model.json" },
                "display": { "position": "right", "width": 200, "height": 400, "hOffset": -50, "vOffset": -100 },
                "mobile": { "show": true, "scale": 0.5, "hOffset": -20, "vOffset": -40 },
                "dialog": { "enable": true, "script": { 'tap body': 'Hey! Stop that!' } },
                "react": { "opacityDefault": 0.85, "opacityOnHover": 1 },
                "eyeTrack": true,
            });
          } catch(e) {
            console.error("Live2D widget failed to load:", e);
          }
      });

      applySettings();
      renderHistory();
      loadWorkspaceData();
      setReconMode('website');
      
        // --- Cursor and Trail Logic ---
      const cursor = document.querySelector('.cursor');
      let mouseX = 0;
      let mouseY = 0;
      let lastTrailTime = 0;
      const trailDelay = 50; 

      function updateCursor() {
          cursor.style.left = `${mouseX}px`;
          cursor.style.top = `${mouseY}px`;
          requestAnimationFrame(updateCursor);
      }

      document.addEventListener('mousemove', (e) => {
          mouseX = e.clientX;
          mouseY = e.clientY;
          const currentTime = Date.now();
          if (currentTime - lastTrailTime > trailDelay) {
              createTrail(e.clientX, e.clientY);
              lastTrailTime = currentTime;
          }
      });

      function createTrail(x, y) {
          const trail = document.createElement('span');
          trail.className = 'trail';
          trail.innerText = Math.random() < 0.5 ? '0' : '1';
          trail.style.left = `${x}px`;
          trail.style.top = `${y}px`;
          document.body.appendChild(trail);
          trail.addEventListener('animationend', () => {
              trail.remove();
          });
      }
      
      requestAnimationFrame(updateCursor);

      // --- Click Ripple Animation ---
      document.addEventListener('click', (e) => {
          // Don't fire on scrollbar clicks
          if (e.clientX >= document.documentElement.clientWidth || e.clientY >= document.documentElement.clientHeight) {
              return;
          }
          
          const ripple = document.createElement('div');
          ripple.className = 'click-effect';
          document.body.appendChild(ripple);

          ripple.style.top = `${e.clientY}px`;
          ripple.style.left = `${e.clientX}px`;

          // Clean up the element after the animation is done to prevent DOM clutter
          ripple.addEventListener('animationend', () => {
              ripple.remove();
          });
      });
      
    });
  </script>

</body>
</html>
